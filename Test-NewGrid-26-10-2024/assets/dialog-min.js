YUI.add("squarespace-dialog",function(a){a.namespace("Squarespace");a.Squarespace.OPEN_DIALOGS=[];a.Squarespace.DialogStates={CLOSED:1,EDITING:2,LOADING:3,CLOSING:4,SAVING:5,MOVING:6};a.Squarespace.EditingDialog=Class.extend(a.Squarespace.ZombieGizmo,{_name:"EditingDialog",_events:{show:{},shown:{},aftershowanim:{},"align-to-anchor":{},"aligned-to-anchor":{},loading:{},"cancel-loading":{},"loading-ready":{},ready:{},drag:{},hide:{},hidden:{},close:{},closed:{},canceled:{},"cancel-clicked":{},"overlay-click":{},
"show-save-overlay":{},"save-overlay-shown":{},"hide-save-overlay":{},"save-overlay-hidden":{},"render-anchor":{},datachange:{},datachanged:{},"send-requested":{emitFacade:!0},"remove-requested":{},"data-saved":{},"auto-save":{},"auto-save-requested":{emitFacade:!0},"allow-editing":{},"editing-allowed":{},"show-errors":{},"local-errors":{}},initialize:function(c){this._super(c);this.setParams(c);this._setState("CLOSED");this.bodyEvents=[];this.buttonEvents=[];this.globalEvents=[];this.childDialogs=
[];this.verticalFields=[];this.timers=[];this.fields={};this.sections={};this._noNameFields=[];this._setEdited(!1);this.NOTCH_WIDTH=20;this.BUTTONS_BASE_IDX=100;this.NOTCH_HEIGHT=11;this.lastTabIndex=1;this.on("datachange",this.onDataChange,this);this._debug=new a.Squarespace.Debugger({name:"EditingDialog",output:!1});this.publish("show",{prefix:"EditingDialog",broadcast:2,emitFacade:!0});this.publish("dismiss",{prefix:"EditingDialog",broadcast:2,emitFacade:!0});this.publish("tab-shown",{prefix:"EditingDialog",
broadcast:2,emitFacade:!0});this.publish("button-click",{prefix:"EditingDialog",broadcast:2,emitFacade:!0,preventable:!1})},defaultOpts:{tabs:[],initialData:{},buttons:[],style:"standard",colorScheme:"light",buttonAlign:"right",position:"center",verticalHeight:"fixed",flyoutPointerDirection:"left",closingText:"Canceled...",savingText:"Saving...",top:60,closeOthers:!0,disableTips:!0,closeable:!0,autoFocus:!0,discardChangesConfirmation:!0,overlay:!1,validateActiveTabOnly:!1,edgeMargin:11,initialDataByReference:!1,
frameless:!1},getName:function(){return this.params.name},getInitialData:function(){return this.params.initialData},setParams:function(c){if(c){this.params=a.merge(this.defaultOpts,c);this.params.primaryTabs&&(this.params.tabs=this.params.tabs.concat(this.params.primaryTabs),delete this.params.primaryTabs);this.params.secondaryTabs&&(this.params.tabs=this.params.tabs.concat(this.params.secondaryTabs),delete this.params.secondaryTabs);if((!this.params.tabs||0===this.params.tabs.length)&&this.params.fields)this.params.tabs=
[{fields:this.params.fields}];this.params.tabs[0].tabTitle||(this.params.tabs[0].tabTitle="Item");this.params.tabs[0].name||(this.params.tabs[0].name="item");"transparent"===this.params.style&&(this.params.disableSaveOverlay=!0);!c.discardChangesConfirmation&&0===this.params.buttons.length&&(this.params.discardChangesConfirmation=!1);this.definitionChanged=!0}},show:function(c){this.fire("show");this._debug.log("Showing",["showParams",c],["this.params",this.params]);this.moving&&(this._setState("EDITING"),
this.animation&&this.animation.stop(),this.fire("cancel-loading"));if(!this.destroyTimer&&!this._isState("LOADING")&&!this._isState("CLOSING"))if(a.Squarespace.ToolTipManager&&this.params.disableTips&&a.Squarespace.ToolTipManager.disableTooltips(),this.anchorEl&&this.anchorEl.removeClass("targeted"),c&&this._setShowParams(c),this.params.parentDialog&&this.params.parentDialog.addChildDialog(this),this._isState("CLOSED")){this.definitionChanged=!1;if(this.params.closeOthers){c=0;for(var b=a.Squarespace.OPEN_DIALOGS.length;c<
b;++c)a.Squarespace.OPEN_DIALOGS[c].cancel()}a.Squarespace.OPEN_DIALOGS.push(this);a.one(document.body).addClass("dialog-open");this.fire("loading");this._setState("LOADING");this.timers.push(a.later(100,this,function(){this.params.closeable&&a.Squarespace.EscManager.addTarget(this);this.globalEvents.push(a.on("resize",this.onResize,a.one(window),this))}));a.one(document).get("winWidth");a.one(document).get("winHeight");this._addTitleEl();this._addBodyEl();this.mainEl=a.Node.create('<div class="main-container"></div>').append(this.titleEl).append(this.bodyEl).append(this.controlsEl);
c="";this.params.frameless?c+="frameless-dialog-wrapper ":this.params.disableStandardDialogWrapperClass||(c+="standard-dialog-wrapper ");c+="squarespace-managed-ui "+this.params.style+" "+this.params.colorScheme+" buttons-"+this.params.buttonAlign;this.params.name&&(c+=" dialog-"+a.Squarespace.Utils.slugify(this.params.name));this.el=a.Node.create('<div class="'+c+'"></div>').append(this.mainEl);this.bodyEvents.push(this.el.on("click",function(a){a.target.ancestor(".sqs-button",!0)||(this.cancelChildDialogs(),
this.fire("click",a))},this));this.params.zIndex?this.zIndex=this.params.zIndex:(a.Squarespace.DIALOG_ZINDEX_BASE+=10,this.zIndex=a.Squarespace.DIALOG_ZINDEX_BASE);this.el.setStyle("zIndex",this.zIndex);this.params.draggable&&this.enableDragging();this.params.hidable&&this._addHideEl();this.params.headerButton&&this._addHeaderButtonEl();this.buttonHolder=a.Node.create("<div>").addClass("button-holder");this.autosaveEl=a.Node.create("<div>").addClass("autosave-state");this.controlsEl&&(this.controlsEl.append(this.autosaveEl),
this.controlsEl.append(this.buttonHolder));c=this.anchorEl?this._positionWithAnchorEl():this._positionWithDefault();this.params.loadingState?(c=this._anim({node:this.el,to:c[1]?{opacity:0.9,top:c[1]}:{opacity:0.9},duration:0.15,easing:a.Easing.easeOutStrong}),c.on("end",function(){this.fire("loading-ready")},this),c.run()):this.dataReady();if("full"==this.params.verticalHeight||"fit"==this.params.verticalHeight)this.el.setStyles({top:this.params.edgeMargin+"px",bottom:this.params.edgeMargin+"px"}),
this.params.top=this.params.edgeMargin;this.params.overlay&&(this.overlayEl=a.Node.create("<div>").addClass("dialog-screen-overlay"),this.overlayEl.setStyle("zIndex",this.zIndex-1),a.one(document.body).append(this.overlayEl),JSTween.tween(this.overlayEl.getDOMNode(),{opacity:{start:0,stop:100*this.params.overlay,time:0,duration:0.3,effect:"easeOut"}}),this.globalEvents.push(a.on("click",this.onOverlayClick,this.overlayEl,this)));this.moveIntoView();a.later(300,this,function(){this._shown=!0;this.fire("shown",
this)})}else this.anchorEl&&(this.anchorEl.addClass("targeted"),this._setState("LOADING"),this.moving=!0,this.updateTitle(),this.fire("loading"),this._updatePosition(!1),this.position&&(this.animation=this._anim({node:this.el,to:{left:this.position.getX()+"px",top:this.position.getY()+"px"},duration:0.25,easing:a.Easing.easeOutStrong}),this.animation.on("end",function(){this.fire("loading-ready");this.dataReady()},this),this.animation.run()))},_setShowParams:function(a){a.data&&(this.data=a.data);
a.anchor&&(this.anchorEl=a.anchor);a.top&&(this.params.top=a.top);a.flyoutPointerDirection&&(this.params.flyoutPointerDirection=a.flyoutPointerDirection)},_addHeaderButtonEl:function(){var c=a.Node.create('<div class="header-button"></div>'),b=a.Node.create('<input type="button" value="'+this.params.headerButton.title+'" />');b.setData("type",this.params.headerButton.type);a.on("click",this.params.headerButton.onclick,b,this);this.el.append(c.append(b))},_addBodyEl:function(){this.bodyEl=a.Node.create('<div class="body-block"></div>');
0!==this.params.buttons.length?this.controlsEl=a.Node.create('<div class="controls-block"></div>'):this.bodyEl.addClass("bottom")},_addTitleEl:function(){this.titleEl=a.Node.create('<div class="title-block loading"></div>');this.titleTextEl=a.Node.create('<div class="text-holder"></div>');this.titleEl.append(this.titleTextEl);this.tabsEl=a.Node.create('<div class="configuration-container-tabs"></div>');a.Lang.isNumber(this.currentTabIndex)||(this.currentTabIndex=0);this.titleEl.append(this.tabsEl);
this.updateTitle()},_addHideEl:function(){var c=a.Node.create('<div class="dialog-close"></div>');this.el.prepend(c);c.on("click",function(){this.fire("user-close");this.close()},this)},_positionWithAnchorEl:function(){var c,b,e,d,f=this.params.width;this.el.setStyle("position",this.params.forcePosition||"absolute");this.anchorEl.addClass("targeted");"left"===this.params.flyoutPointerDirection||"right"===this.params.flyoutPointerDirection?(this.el.setStyle("width",f+this.NOTCH_HEIGHT+"px"),this.mainEl.setStyle("width",
f+"px"),this.el.addClass("flyout")):"hidden"===this.params.flyoutPointerDirection?(this.el.setStyle("width",f+"px"),this.mainEl.setStyle("width",f+"px")):"top"===this.params.flyoutPointerDirection?(this._initNotchEl("top"),this.el.insertBefore(this.notchEl,this.mainEl),e=this.anchorEl.get("offsetWidth"),b=this.anchorEl.get("offsetHeight"),c=this.anchorEl.getX(),b=this.anchorEl.getY()+b,f>e&&(c-=(f-e)/2),this.currentXY=[c,b-3],this.notchEl.setStyle("marginLeft",(f-30)/2+"px"),e=this.params.left||this.currentXY[0],
d=this.params.top||this.currentXY[1],this.el.setStyles({left:e+"px",top:d+"px",width:f+"px"}),this.mainEl.setStyle("width",f+"px")):"bottom"===this.params.flyoutPointerDirection?(this._initNotchEl("top","bottom"),this.el.append(this.notchEl),e=this.anchorEl.get("offsetWidth"),b=this.anchorEl.get("offsetHeight"),c=this.anchorEl.getX(),b=this.anchorEl.getY()+b,f>e&&(c-=(f-e)/2),this.currentXY=[c,b-3],this.notchEl.setStyle("marginLeft",(f-30)/2+"px"),e=this.params.left||this.currentXY[0],d=this.params.top||
this.currentXY[1],this.el.setStyles({left:e+"px",top:d+"px",width:f+"px"}),this.mainEl.setStyle("width",f+"px")):(this.currentXY=[this.anchorEl.getX()+(this.anchorEl.get("offsetWidth")-f)/2,this.anchorEl.getY()+(this.anchorEl.get("offsetHeight")-this.params.height)/2-15],this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px",width:f+"px"}),this.el.setStyle(),this.mainEl.setStyle("width",f+"px"),b=this.currentXY[1]);a.one(a.config.doc.body).append(this.el);return[c,b]},_positionWithDefault:function(){var c,
b=a.one(document).get("winWidth");a.one(document).get("winHeight");this.el.setStyle("position","fixed");"right"===this.params.position?(this.el.setStyles({right:this.params.edgeMargin+"px",top:"0px"}),0===this.params.edgeMargin&&(this.titleEl.setStyle("border-radius","0px"),this.controlsEl.setStyle("border-radius","0px"))):"undefined"!==typeof this.params.left?this.currentXY=[this.params.left,this.params.top]:(this.currentXY=[(b-this.params.width)/2,this.params.top],this.el.setStyle("position","fixed"));
this.currentXY&&(this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px"}),c=this.currentXY[1]);this.el.setStyle("width",this.params.width+"px");this.mainEl.setStyle("width",this.params.width+"px");a.one(document.body).append(this.el);return[void 0,c]},isOpen:function(){return this._isState("LOADING")||this._isState("EDITING")},disableBodyScroll:function(){this.oldBodyScroll=a.one("body").getStyle("overflow");a.one("body").setStyle("overflow","hidden")},restoreBodyScroll:function(){this.hasOwnProperty("oldBodyScroll")&&
(this.oldBodyScroll?a.one("body").setStyle("overflow",this.oldBodyScroll):a.one("body").setStyle("overflow",null))},getAnchorEl:function(){return this.anchorEl},getChildDialogs:function(){return this.childDialogs},addChildDialog:function(a){0>this.childDialogs.indexOf(a)&&(this.cancelChildDialogs(),this._debug.log("addChildDialog",a),this.childDialogs.push(a));a.params.parentDialog=this},removeChildDialog:function(c){this.childDialogs=a.Array.filter(this.childDialogs,function(a){return a!==c},this)},
enableDragging:function(){this.titleEl.setStyle("cursor","move");this.dd=new a.DD.Drag({node:this.el});this.dd.on("drag:mouseDown",function(c){a.Squarespace.Help&&a.Squarespace.Help.active&&c.halt();c.ev.target.ancestor(".body-block",!0)&&c.halt()},this);this.dd.on("drag:start",this.cancelChildDialogs,this);this.dd.on("drag:drag",function(a){this.fire("drag",a)},this);this.dd.on("drag:end",function(a){this.moveIntoView()},this)},temporaryHide:function(c){this.fire("hide");a.Array.each(this.childDialogs,
function(a){a.temporaryHide()},this);this.hideAnim&&this.hideAnim.stop();this._hideAnimEvent&&this._hideAnimEvent.detach();this.overlayHideAnim&&this.overlayHideAnim.stop();this._overlayHideAnimEvent&&this._overlayHideAnimEvent.detach();this.hideAnim=this._anim({node:this.el,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong});this.overlayEl&&(this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong}),this._overlayHideAnimEvent=this._subscribe(this.overlayHideAnim,
"end",function(){this.overlayEl.setStyle("display","none")}));this._hideAnimEvent=this._subscribe(this.hideAnim,"end",function(){this.el.setStyle("display","none");this.fire("hidden",this)});c?(this.el.setStyle("display","none"),this.overlayEl&&this.overlayEl.setStyle("display","none"),this.fire("hidden",this)):(this.hideAnim.run(),this.overlayEl&&this.overlayHideAnim.run())},temporaryShow:function(c){this.fire("show",this);c&&this._setShowParams(c);this.hideAnim&&this.hideAnim.stop();this._hideAnimEvent&&
this._hideAnimEvent.detach();this.overlayHideAnim&&this.overlayHideAnim.stop();this.overlayEl&&(this.overlayEl.setStyle("display","block"),this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:this.params.overlay},duration:0.35,easing:a.Easing.easeOutStrong}),this.overlayHideAnim.run());this.el.setStyle("display","block");this.hideAnim=this._anim({node:this.el,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});this._hideAnimEvent=this._subscribeOnce(this.hideAnim,"end",function(){this.fire("shown",
this)});this.hideAnim.run();this._showChildren();this.moveIntoView()},_applyMethodToChildren:function(){var c=arguments[0],b=Array.prototype.slice.call(arguments,1);a.Array.each(this.childDialogs,function(a){a[c].apply(a,b)},this)},_showChildren:function(){this._applyMethodToChildren("temporaryShow")},_hideChildren:function(){this._applyMethodToChildren("temporaryHide")},cancelChildDialogs:function(){this._applyMethodToChildren("cancel");this.childDialogs=[]},isVisible:function(){return!this._isState("CLOSED")},
_updatePosition:function(c){if(this.el&&this.anchorEl){var b=this.el.get("offsetHeight"),e=this.params.flyoutPointerDirection;if(!("top"===e||"bottom"===e)){if("centered"===e){var d=this.anchorEl.getXY();this.position=new a.Squarespace.Position({x:d[0]+(this.anchorEl.get("offsetWidth")-this.params.width)/2,y:d[1]+(this.anchorEl.get("offsetHeight")-b)/2,w:this.params.width,h:b});this.position.nudgeFix()}else this.position=new a.Squarespace.Position({avoidElX:this.anchorEl,avoidElY:this.anchorEl,xdir:"right",
ydir:"bottom",x:this.anchorEl.getX(),y:this.anchorEl.getY(),xo:2,yo:0,w:this.params.width+this.NOTCH_HEIGHT,h:b}),this.position.reflectFix();"hidden"!==e&&"centered"!==e&&this._reattachNotchEl();c&&(this.el.setXY(this.position.getXY()),this._alignNotch(this.anchorEl))}}},_reattachNotchEl:function(){var a="right"===this.position.xdir?"left":"right";this.notchEl?(this.notchEl.set("className","flyout-notch-"+a),this.notchEl.inDoc()&&this.notchEl.remove()):this._initNotchEl(a);"right"===this.position.xdir?
this.el.insertBefore(this.notchEl,this.mainEl):this.el.append(this.notchEl)},_initNotchEl:function(c,b){this.notchEl=a.Node.create('<div class="flyout-notch-'+c+'">&nbsp;</div>');a.Lang.isString(b)&&this.notchEl.addClass(b)},_alignNotch:function(a){if(this.notchEl){var b=this.el.get("offsetHeight"),b=Math.max(b-36,220),e=12,d=this.el.get("region");a=a.get("region");var f=a.top+a.height/2;a.top>d.top&&(e=f-d.top-11,e=Math.min(b,Math.max(12,e)));this.notchEl.setStyle("marginTop",e+"px")}},onDataChange:function(a){this.fire("render-anchor",
this.getData());this.setEdited();this._debug.log("onDataChange");this.fire("datachanged")},onOverlayClick:function(a){a.halt();this.fire("overlay-click");this.params.disableOverlayCancel||this.close()},setEdited:function(){this._isState("SAVING")||(this.params.discardChangesConfirmation&&!this._onBeforeUnloadEvt&&(this._onBeforeUnloadEvt=a.on("beforeunload",function(a){this.isVisible()&&(a.returnValue="You have unsaved changes.")},this)),this._setEdited(!0))},clearEdited:function(){this._onBeforeUnloadEvt&&
this._onBeforeUnloadEvt.detach();this._setEdited(!1)},_setEdited:function(a){this.edited=!!a;this.editedSinceLastSave=!!a},getEditedSinceLastSave:function(){return this.editedSinceLastSave},getNextTabIndex:function(){return this.lastTabIndex++},getEdited:function(){return this.edited},isState:function(a){return this.getState()===a},getState:function(){return this.state},setInitialData:function(c){this.params.initialData=this.params.initialDataByReference?c:a.clone(c,!0);this.fields&&a.Object.each(this.fields,
function(b,c){this._isDialogField2(b)&&(b.get("name")&&!a.Lang.isUndefined(this.params.initialData[b.get("name")]))&&(b.set("data",this.params.initialData[b.get("name")],{source:"setInitialData"}),b.setCurrentDataAsInitial())},this)},getBodyHeight:function(){return this.params.height?this.params.height:this._getFullHeight()},setActiveFlyout:function(c){this.activeFlyout&&this.activeFlyout.field.closeFlyout();a.later(10,this,function(){this.activeFlyout=c})},clearActiveFlyout:function(){this.activeFlyout=
null},onResize:function(){var c=a.one(document).get("winWidth");a.one(document).get("winHeight");if(!this.anchorEl&&!this.params.draggable){var b={};if("full"==this.params.verticalHeight||"fit"==this.params.verticalHeight)this.bodyHeight=this.getBodyHeight(),"fit"==this.params.verticalHeight&&this.bodyHeight>this.observedHeight&&(this.bodyHeight=this.observedHeight),this.bodyEl.setStyle("height",this.bodyHeight+"px"),this.bodyEl.all(".scrollable-body").each(function(a){a.setStyles({height:this.bodyHeight-
30+"px",paddingBottom:"30px"})},this),this.resizeVerticalFields();"right"!==this.params.position&&(this.hideErrors(),b.left=(c-this.params.width)/2,b.top=this.params.top,this.params.left&&(b.left=this.params.left));this.currentXY=[b.left,b.top];this.moveAnim&&this.moveAnim.stop();this.moveAnim=this._anim({node:this.el,to:b,duration:0.15,easing:a.Easing.easeOutStrong});this.moveAnim.run()}this.moveIntoView()},moveIntoView:function(c){if(this.params.draggable){c&&(!this.anchorEl&&!this.position)&&(c=
!1);var b={},e=this.el.get("docScrollX"),d=this.el.get("docScrollY"),f=this.el.get("winWidth")+e,g=this.el.get("winHeight"),h=g+d,k=this.el.getY(),l=this.el.getX();k<d&&(b.top=d);k+this.el.get("offsetHeight")>h&&(b.top=h-this.el.get("offsetHeight"));l+this.el.get("offsetWidth")>f&&(b.left=f-this.el.get("offsetWidth"));l<e&&(b.left=e);c&&(b.top=b.top?Math.max(b.top,this.position.getY()):this.position.getY());"fixed"===this.params.forcePosition&&(a.Lang.isValue(b.top)&&b.top>this.el.get("winHeight"))&&
(b.top=Math.max(0,g-this.el.get("offsetHeight")));0!==a.Object.size(b)&&this._anim({node:this.el,to:b,duration:0.3,easing:a.Easing.easeOutStrong}).run();this.preferredHeight+120>g?(this.bodyHeight=g-120,this.bodyEl.setHeight(this.bodyHeight)):this.bodyHeight!=this.preferredHeight&&(this.bodyHeight=this.preferredHeight,this.bodyEl.setHeight(this.preferredHeight))}},scrollIntoView:function(a){this.el.scrollIntoView(a)},showErrors:function(c){this.fire("show-errors",c);this.allowEditing();this.currentErrors=
c;this.errorCount=a.Object.size(c);this.errorsByTab={};a.Object.each(c,function(a,c){var d=this.getField(c);d||console.error("Server error returned for a missing dialog field: "+c);d.tab.tabNavigationObj&&d.tab.tabNavigationObj.addClass("error");this.errorsByTab[d.tab.name]?this.errorsByTab[d.tab.name]++:this.errorsByTab[d.tab.name]=1},this);this.activateErrors()},clearError:function(a){this.currentErrors&&this.currentErrors[a.getName()]&&(this.errorsByTab[a.tab.name]--,delete this.currentErrors[a.getName()],
this.errorCount--,a.tab.tabNavigationObj&&0===this.errorsByTab[a.tab.name]&&a.tab.tabNavigationObj.removeClass("error"))},activateErrors:function(){if(this.errorCount){var c=null;a.Array.each(this.currentTab.tabFields,function(a){this.currentErrors[a.getName()]&&(c||(c=a,c.scrollIntoView()),a.showError(this.currentErrors[a.getName()]))},this);c&&a.Lang.isFunction(c.focus)&&c.focus()}},hideErrors:function(){this.currentTab&&a.Array.each(this.currentTab.tabFields||[],function(c){a.Lang.isFunction(c.hideError)&&
c.hideError()},this)},updateTitle:function(c){var b=this.params.tabs[this.currentTabIndex];b&&(this.currentTab&&b.title!=this.currentTab.title)&&(this.currentTab.title=b.title);a.Lang.isUndefined(c)&&(c=this.state);var b=this.currentTab&&this.currentTab.title?this.currentTab.title:this.params.title,e="";this.params.subtext&&(e='<div class="title-subtext">'+this.params.subtext+"</div>");switch(c){case a.Squarespace.DialogStates.LOADING:this.params.loadingText&&this.setTitleHtml('<div class="title-text">'+
this.params.loadingText+"</div>"+e);break;case a.Squarespace.DialogStates.EDITING:b&&this.setTitleHtml('<div class="title-text">'+b+"</div>"+e);break;case a.Squarespace.DialogStates.SAVING:this.params.savingText&&this.setTitleHtml('<div class="title-text">'+this.params.savingText+"</div>"+e)}},setTitleHtml:function(a){this.titleTextEl.setHTML(a)},setData:function(c){a.Array.each(this.currentTab.tabFields,function(b,e){if(b.setValue){var d=c[b.getName()];b.setValue(a.Lang.isValue(d)?d:null);this.fire("datachange",
b)}},this)},focusTab:function(){this.currentTab&&(this.fire("tab-focused",{tabName:this.currentTab.name}),a.Array.some(this.currentTab.tabFields,function(a,b){var e=!(!a.setValue||!a.focus),d=this._isDialogField2(a),f=!(!d||!a.get("focusable"));if(e&&!d||f)return a.focus(),!0},this))},_getFullHeight:function(){return a.one(document).get("winHeight")-2*this.params.edgeMargin-this.controlsHeight-this.titleEl.get("offsetHeight")},dataReady:function(){var c;this.clearEdited();this._setState("EDITING");
this.titleEl.removeClass("loading");this.params.initialData||(this.params.initialData={});this.bodyHeight=this.params.height;this.controlsHeight="standard"===this.params.style?65:60;if("full"===this.params.verticalHeight||"fit"===this.params.verticalHeight)this.bodyHeight=this._getFullHeight();this.preferredHeight=this.bodyHeight;this.bodyEl.setStyle("width",this.params.width+"px");this.params.overlay&&!this.params.doNotDisableBodyScroll&&this.disableBodyScroll();if(this.moving){this.moving=!1;this.updateTitle();
if(this.definitionChanged)this.definitionChanged=!1,this.destroyBody(),this.destroyButtons(),this.render(),c=this._anim({node:this.bodyEl,duration:0.25,easing:a.Easing.easeOutStrong,to:{height:this.bodyHeight}}),c.on("end",function(){this.fire("ready")},this),c.run();else{if(this.rendered)this.setData(this.params.initialData),this.params.autoFocus&&this.focusTab();else this.once("rendered",function(){this.setData(this.params.initialData);this.params.autoFocus&&this.focusTab()},this);this.fire("ready")}this.clearEdited()}else if(this.currentTabIndex=
0,this.currentTab=this.params.tabs[0],this.updateTitle(),this.params.loadingState)c=this._anim({node:this.el,to:{opacity:1},duration:0.15,easing:a.Easing.easeOutStrong}),c.run(),this.controlsEl&&(c=this._anim({node:this.controlsEl,to:{height:this.controlsHeight},duration:0.15,easing:a.Easing.easeOutStrong}),c.run()),c=this._anim({node:this.bodyEl,to:{height:this.bodyHeight},duration:0.25,easing:a.Easing.easeOutStrong}),c.on("end",function(){this.render();this.fire("ready")},this),c.run();else{this.render();
this.currentData=this.params.initialData;var b=this;switch(this.params.showAnim){case "custom":this.params.customShowAnim(this.el,function(){b.fire("ready")});break;case "fade":this.el.transition({opacity:{duration:0.2,value:1},easing:"ease-out"},function(){b.fire("ready");b.el&&b.el.setStyle("transform",null)});break;case "noshow":this.el.setStyles({display:"none"});b.fire("ready");break;default:b.fire("ready"),this.el.addClass("visible")}}JSTween.play()},containsNode:function(a){return this.bodyEl&&
this.bodyEl.contains(a)},activateTab:function(c,b){this.hideErrors();var e=b||c.target.getData(),d=parseInt(e.index,10);this.currentTab||(this.currentTab=e);a.Array.each(this.params.tabs,function(a,b){a.tabNavigationObj.toggleClass("active",b===d);b===d&&this._showPanelByIndex(d)},this)},_showField:function(a){(this._isDialogField2(a)&&a.get("visible")||!this._isDialogField2(a)&&!a.config.hidden)&&a.show(!0)},_showPanelByIndex:function(c){if(c!=this.currentTabIndex){var b,e=a.Easing.easeBothStrong,
d=this.params.tabs[c],f=this.params.tabs[this.currentTabIndex];this.params.noTabAnim||(d.tabPanelObj.animation&&d.tabPanelObj.animation.stop(!0),f.tabPanelObj.animation&&f.tabPanelObj.animation.stop(!0));b=f.tabFields;this.params.noTabAnim?(f.tabPanelObj.setStyles({opacity:1,zIndex:"300"}),f.tabPanelObj.addClass("hidden")):(d.tabPanelObj.setStyles({left:(d.index>f.index?1:-1)*this.params.width+"px",opacity:1,zIndex:"300"}),f.tabPanelObj.setStyle("zIndex","0"),b=this._anim({node:f.tabPanelObj,to:{left:(d.index<
f.index?1:-1)*this.params.width+"px"},duration:0.5,easing:e}),b.on("end",function(){this.tab.addClass("hidden")},{tab:f.tabPanelObj}),b.run(),f.tabPanelObj.animation=b);this.currentTab=d;this.currentTabIndex=c;this.updateTitle();d.tabPanelObj.removeClass("hidden");this.params.noTabAnim?(b=this.currentTab.tabFields,a.Array.forEach(b,function(a){this._showField(a)},this),this.focusTab(),this.activateErrors()):(b=this._anim({node:d.tabPanelObj,to:{left:0},duration:0.5,easing:e}),b.on("end",function(){a.Array.forEach(this.currentTab.tabFields,
function(a){this._showField(a)},this);this.focusTab();this.activateErrors()},this),b.run(),d.tabPanelObj.animation=b);this.currentTab.height&&(this.currentTab.tabPanelObj.setStyle("height",f.height-50),this._anim({node:this.bodyEl,to:{height:this.currentTab.height},duration:0.5,easing:e}).run());this.bodyEl.toggleClass("scrollable",!!this.currentTab.scroll);this.currentTab.scroll?this.bodyEl.plug(a.Squarespace.Plugin.ScrollLock):this.bodyEl.unplug(a.Squarespace.Plugin.ScrollLock);this.fire("tab-shown",
{name:this.currentTab.name,title:this.currentTab.title})}},render:function(){var c;this.rendered||(this.observedHeight=0,this.tabs=[],this.tabsEl.setContent(""),a.Array.each(this.params.tabs,function(b,e){c=a.Node.create('<a href="javascript:noop();" class="configuration-container-tab">'+b.tabTitle+"</a>");c.setData("index",e);0===e&&c.addClass("active");1<this.params.tabs.length&&(this.params.tabs[e].noTabTitle&&c.addClass("noTabTitle"),this.bodyEvents.push(c.on("click",function(a){a.preventDefault();
this.activateTab.apply(this,arguments)},this)),this.tabsEl.append(c));this.params.tabs[e].tabNavigationObj=c;this.params.tabs[e].index=e;this.renderTab(this.params.tabs[e],0==e)},this),this.renderButtons(),this.bodyHeight||(this.preferredHeight=this.bodyHeight=this.observedHeight+14),"fit"==this.params.verticalHeight&&this.bodyHeight>this.observedHeight&&(this.bodyHeight=this.observedHeight),this.fire("rendered"),this.rendered=!0,this.bodyEl.setStyle("height",this.bodyHeight+"px"),this.controlsEl&&
this.controlsEl.setStyle("height",this.controlsHeight+"px"),this._updatePosition(!0),this.params.autoFocus&&this.focusTab())},getButtons:function(){return this.params.buttons},setButtons:function(){var c=arguments;1===arguments.length&&a.Lang.isArray(arguments[0])&&(c=arguments[0]);this.params.buttons=[];this.destroyButtons();c.forEach(function(a){this.params.buttons.push(a)},this);this.isVisible()&&this.renderButtons()},_removeButton:function(c){var b=a.Array.filter(this.getButtons(),function(a,
d){return a!==c&&a.type!==c},this);this.setButtons(b)},_getNextTabIndex:function(){return this.BUTTONS_BASE_IDX+this.lastTabIndex++},_disableButton:function(a){a.addClass("disabled").one("input").set("disabled","disabled")},renderButtons:function(){this.saveAndCloseButton=a.Node.create(a.Lang.sub('<input class="saveAndClose" tabIndex="{tabIndex}" type="button" value="Save &amp; Close" />',{tabIndex:this._getNextTabIndex()}));this.saveButton=a.Node.create(a.Lang.sub('<input class="save" tabIndex="{tabIndex}" type="button" value="Save" />',
{tabIndex:this._getNextTabIndex()}));this.cancelButton=a.Node.create(a.Lang.sub('<a class="cancel" href={href} tabIndex="{tabIndex}">Cancel</a>',{tabIndex:this._getNextTabIndex(),href:"javascript:noop();"}));this.removeButton=a.Node.create(a.Lang.sub('<input class="remove" tabIndex="{tabIndex}" type="button" value="Remove" />',{tabIndex:this._getNextTabIndex()}));this.buttonEvents.push(a.on("click",function(a){a.halt();this._getButtonClickHandler("saveAndClose",this.saveAndClose)(a)},this.saveAndCloseButton,
this),a.on("click",this._getButtonClickHandler("save",this.save),this.saveButton),a.on("click",this._getButtonClickHandler("remove",this.remove),this.removeButton),a.on("click",this._getButtonClickHandler("close",this.close),this.cancelButton),a.on("click",this._getButtonClickHandler("cancel",this.cancelClick),this.cancelButton));var c,b=a.clone(this.params.buttons);i=this.params.buttons.length;for(0<i&&a.Squarespace.Utils.isDamaskEnabled()&&b.reverse();0<=--i;){var e;if(c=b[i]){switch(c.type){case "cancel":this.cancelButton.set("innerHTML",
c.title);e=a.Node.create('<div class="cancel-block"></div>');e.append(this.cancelButton);break;case "save":this.saveButton.set("value",c.title);e=a.Node.create('<div class="button-block"></div>');e.append(this.saveButton);break;case "remove":this.removeButton.set("value",c.title);e=a.Node.create('<div class="button-block"></div>');e.append(this.removeButton);break;case "saveAndClose":this.saveAndCloseButton.set("value",c.title);e=a.Node.create('<div class="button-block"></div>');e.append(this.saveAndCloseButton);
break;default:var d;"text"===c.style?(d='<a href="javascript:noop();">'+c.title+"</a>",e=a.Node.create('<div class="cancel-block"></div>')):(d=a.Node.create('<input type="button" value="'+c.title+'" />'),c.className&&d.addClass(c.className),e=a.Node.create('<div class="button-block"></div>'));e.append(d);this.publish("button-"+c.type,{emitFacade:!0,prefix:"EditingDialog",broadcast:2});this.buttonEvents.push(a.on("click",this._getButtonClickHandler(c.type),d))}this.buttonHolder.append(e);c.disabled&&
this._disableButton(e)}}},cancelClick:function(a){this.fire("cancel-click")},_getButtonClickHandler:function(c,b){return a.bind(function(e){this.fire("button-"+c)?a.Lang.isFunction(b)&&b.call(this,e):e.halt();this.fire("button-click",{type:c})},this)},_isOverlayAnimationRunning:function(){return a.Lang.isValue(this.saveOverlayAnimationManager)&&this.saveOverlayAnimationManager.isRunning()},showSaveOverlay:function(c){this.fire("show-save-overlay");if(!this.params.disableSaveOverlay){this._isOverlayAnimationRunning()&&
this.saveOverlayAnimationManager.stop(!0);this.saveOverlay&&this.saveOverlay.remove();var b=this.titleEl.get("offsetHeight");this.saveOverlay=a.Node.create('<div class="save-overlay">&nbsp;</div>');this.saveOverlay.setStyles({height:this.mainEl.get("offsetHeight")-b-10+"px",marginTop:b+5+"px",width:this.bodyEl.get("offsetWidth")+"px"});this.mainEl.append(this.saveOverlay);c&&this.titleEl.addClass("save-overlay-active");this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager;this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,
to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0.8},duration:0.25,easing:a.Easing.easeOutStrong}));this.autosaveEl&&this.saveOverlayAnimationManager.push(this._anim({node:this.autosaveEl,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));"transparent"!==this.params.style&&(this.saveOverlayAnimationManager.push(this._anim({node:this.titleEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong})),
this.controlsEl&&this.saveOverlayAnimationManager.push(this._anim({node:this.controlsEl.get("firstChild"),to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong})));this.saveOverlayAnimationManager.on("end",function(){this.fire("save-overlay-shown")},this);this.saveOverlayAnimationManager.run()}},hideSaveOverlay:function(){this.saveOverlay?(this.fire("hide-save-overlay"),this.titleEl.removeClass("save-overlay-active"),this._isOverlayAnimationRunning()&&this.saveOverlayAnimationManager.stop(!0),
this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager,this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong})),this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong})),this.saveOverlayAnimationManager.on("end",function(){this.saveOverlay.remove();this.fire("save-overlay-hidden");this._setState("EDITING");this.updateTitle()},this),this.saveOverlayAnimationManager.run()):
this._setState("EDITING")},allowEditing:function(){this.hideSaveOverlay();this.clearEdited();this.fire("editing-allowed");this._setState("EDITING")},save:function(){this._showLocalErrors()||(this._debug.log("save"),this.closeOnSend=!1,this._saveData())},_showLocalErrors:function(){this.hideErrors();var c=function(a){return a.inActiveFrame},b=this.currentTab,e=function(a){return a.inActiveFrame&&a.tab.name===b.name},d=a.Object.values(this.fields),d=this.params.validateActiveTabOnly?d.filter(e,this):
d.filter(c,this),f=!1,g={};a.Array.map(d,function(a){return{field:a,errors:a.getErrors()}}).forEach(function(a){var d=a.errors;d[d.length-1]&&(g[a.field.getName()]=d[d.length-1],f=!0)},this);f&&this.showErrors(g);return f},saveAndShow:function(){this._showLocalErrors()||(this._debug.log("saveAndShow"),this.closeOnSend=!1,this._saveData(),this.show())},saveAndClose:function(){this._showLocalErrors()||(this.fire("preClose"),this._debug.log("saveAndClose"),this.params.closeable&&(this.closeOnSend=!0),
this._saveData())},_saveData:function(){this._debug.log("_saveData");this._isState("SAVING")?this._debug.log("_saveData","Exiting because dialog state is in SAVING"):(this.clearEdited(),this.hideErrors(),this._setState("SAVING"),this.updateTitle(),this.showSaveOverlay(),this._debug.log("_saveData","fire","send-requested"),this.fire("send-requested"))},remove:function(a){a&&a.halt();this.fire("remove-requested")},canClose:function(c,b){if(!this._shown)return console.log("not yet shown!"),!1;if(!a.Array.every(this.childDialogs,
function(a){return a.canClose(this.saveAndClose,this.cancel)},this))return!1;if((this.edited||this.editedSinceLastSave)&&this.params.discardChangesConfirmation){var e=!1,d;for(d in this.fields)this.fields[d].didDataChange()&&(e=!0);if(e)return e=new a.Squarespace.Widgets.Confirmation({render:this.el.ancestor("body")||!0,style:a.Squarespace.Widgets.Confirmation.TYPE.CONFIRM_OR_REJECT,showOverlay:!0,"strings.confirm":"Save","strings.reject":"Discard","strings.title":"Review Changes","strings.message":"You have made changes. Do you want to save or discard them?"}),
e.on("confirm",function(){this.clearEdited();this._debug.log("canClose","calling onSuccess()",c);c.call(this)},this),e.on("reject",function(){this.clearEdited();this._debug.log("canClose","calling onReject()",b);b.call(this)},this),e.on("cancel",function(){a.Squarespace.EscManager.addTarget(this);this._debug.log("canClose","onCancel");this.fire("cancel-close")},this),this._debug.log("canClose",!1,"Showing confirmation dialog"),!1}this._debug.log("canClose",!0);return!0},close:function(a,b){this._debug.log("close",
a);if(!this._isState("EDITING")&&!this._isState("SAVING"))this._debug.log("close","Exiting because state is in Editing or Saving.");else{if(b)this._debug.log("canClose skipped due to force = true");else if(!1===this.canClose(this.saveAndClose,this.cancel)){this._debug.log("close","Exiting because canClose came back false");return}this.fire("close");this.dismiss(!0)}},cancel:function(a){this._debug.log("cancel",a);if(this._isState("EDITING")||this._isState("SAVING"))this.clearEdited(),this.fire("cancel"),
this.dismiss(!1)},dismiss:function(c){c=c?a.bind(this.destroy,this):a.bind(this._finishCancelation,this);this.fire("dismiss");this._setState("CLOSING");this.updateTitle();this.clearEdited();this._preDestroy();this.hideErrors();this.params.overlay&&this.restoreBodyScroll();switch(this.params.hideAnim){case "noHideAnimation":c();break;case "custom":this.params.customHideAnim(this.el,c);break;default:this.el.removeClass("visible"),a.later(a.Squarespace.Constants.DAMASK_ANIMATION_DURATION,this,c)}this.params.overlay&&
this.overlayEl&&(this.overlayEl.destroying=!0,JSTween.tween(this.overlayEl.getDOMNode(),{opacity:{start:100*this.params.overlay,stop:0,time:0,duration:0.4,effect:"easeOut",onStop:a.bind(function(){this.overlayEl&&(this.overlayEl.remove(),this.overlayEl=null)},this)}}));JSTween.play()},_finishCancelation:function(){this.fire("render-anchor",this.getInitialData());this.destroy();this._setState("CLOSED");this.fire("canceled")},_preDestroy:function(){var c=0,b;this._preDestroyCalled=!0;c=a.Squarespace.OPEN_DIALOGS.indexOf(this);
-1!==c&&a.Squarespace.OPEN_DIALOGS.splice(c,1);0===a.Squarespace.OPEN_DIALOGS.length&&a.one(document.body).removeClass("dialog-open");this._applyMethodToChildren("close");c=0;for(b=this.timers.length;c<b;++c)this.timers[c].cancel();this.timers=[];a.Squarespace.EscManager&&a.Squarespace.EscManager.removeTarget(this);this.activeFlyout&&this.activeFlyout.field.closeFlyout();a.Squarespace.ToolTipManager&&this.params.disableTips&&a.Squarespace.ToolTipManager.enableTooltips();this.firstShowEvent&&(this.firstShowEvent.detach(),
this.firstShowEvent=null);this.anchorEl&&this.anchorEl._node&&this.anchorEl.removeClass("targeted")},getErrors:function(){var a=0,b={},e;for(e in this.fields){var d=this.fields[e],f=!1;if(f=this._isDialogField2(d)?d.get("required")&&d.isEmpty():d.config.required&&(""===d.getValue()||0===d.getValue()))b[d.getName()]="This is a required field.",a++}return{errors:a,errorSet:b}},send:function(){var a=this.getErrors(),b=a.errorSet;a.errors?(this.showErrors(b),this.fire("local-errors")):(this.closeOnSend&&
(this.saved=!0,this.closeOnSend=!1,this.close()),this.fire("sent"))},updateAutoSave:function(c,b){if(this.autosaveEl.inDoc()){this.autosaveEl.setStyle("display","block");var e=this._anim({node:this.autosaveEl,from:{opacity:1},to:{opacity:0.5},duration:0.25,easing:a.Easing.easeOutStrong});e.on("end",function(){c?this.autosaveEl.set("innerHTML",c):(this.autosaveEl.set("innerHTML",'Last saved <span class="time"></span>.'),this.autosaveEl.one(".time").plug(a.Squarespace.RelativeTimeDisplay));b?this.autosaveEl.addClass("error"):
this.autosaveEl.removeClass("error");this.autosaveEl.ancestor("body")&&this._anim({node:this.autosaveEl,from:{opacity:0.5},to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}).run()},this);e.run()}this.editedSinceLastSave=!1},_recordFieldData:function(c,b){a.Object.each(b.fields,function(b){if(a.Lang.isFunction(b.getValue)){var d=b.getValue();c[b.getName()]=d;if(void 0!==b.getAssociatedVars)for(var d=b.getAssociatedVars(),f=0;f<d.length;f++)c[d[f].name]=d[f].value}b.fields&&this._recordFieldData(c,
b)},this)},getData:function(){var a={},b;for(b in this.params.initialData)a[b]=this.params.initialData[b];this._recordFieldData(a,this);return a},getField:function(c){var b=this.fields[c];if(a.Lang.isValue(b))return b;for(var e in this.fields)if(this.fields[e].getField&&(b=this.fields[e].getField(c),a.Lang.isValue(b)))return b},getSection:function(a){return this.sections[a]},_renderFields:function(c,b,e,d){a.Array.each(b,function(f,g){var h;if(f){var k=f.type;!d&&!this.params.dontSetWidthOnFields&&
(d=this.params.width-60);d&&!isNaN(d)&&(this._debug.log("availableWidth: ",d),this._debug.log("fieldConfig.width: ",f.width),h=(f.ctor&&f.config?f.config.width:f.width)||1,h=1>=h?Math.floor(h*d):h);"splitter"===k?this._renderSplitter(f,g,b,c,e,d,h):"multi-frame"===k?this._renderMultiFrame(f,g,b,c,e,d,h):"section"===k?this._renderSection(f,g,b,c,e,d,h):"stack"===k?this._renderStack(f,g,b,c,e,d,h):f.ctor&&f.ctor===a.Squarespace.DialogFields.MultiFrame?this._renderDF2MultiFrame(f,g,b,c,e,d,h):this._renderField(f,
g,b,c,e,d,h)}},this)},_renderSplitter:function(c,b,e,d,f,g,h){b=a.Node.create('<div class="split-field clear '+(1<c.fields.length?"padding-adjust":"")+'"></div>');c.width||(c.width=1);g&&!isNaN(g)?(b.setStyle("width",Math.round(c.width*g)+30+"px"),g-=30*(c.fields.length-1)):g=f.get("offsetWidth")-30*(c.fields.length-1)-60;f.append(b);this._renderFields(d,c.fields,b,g);c.countHeight&&(this._takenHeight+=b.get("offsetHeight"));c.hidden&&b.hide()},_renderMultiFrame:function(c,b,e,d,f,g,h){b=new a.Squarespace.DialogFieldGenerators["multi-frame"](c,
this.params.initialData,this);b.type=c.type;b.append(d,e,f,g);b.getName()?this.fields[b.getName()]=b:this._noNameFields.push(b)},_renderDF2MultiFrame:function(c,b,e,d,f,g,h){b=a.merge(c,c.config,{dialog:this,data:this.params.initialData[c.config.name],render:f});c=new c.ctor(b);g&&c.get("boundingBox").setStyle("width",h+"px");(g=c.getName()||c.get("name"))?this.fields[g]=c:this._noNameFields.push(c);c.each(function(a){var f=a.getName()||a.get("name");f?this.fields[f]=a:this._noNameFields.push(a);
d.tabFields.push(a);a.tab=d},this)},_renderSection:function(c,b,e,d,f,g,h){b=a.Node.create('<div class="section-inner clear"></div>');e="section-field container-field-wrapper field-wrapper clear ";void 0!==c.style&&(e+=c.style);e=a.Node.create('<div class="'+e+'"></div>');e.append(b);f.append(e);c.width||(c.width=1);(f=Math.round(c.width*g))&&e.setStyle("width",f+"px");g=Math.round(c.width*g);this._renderFields(d,c.fields,b,g);c.hidden&&e.hide();c.name&&(this.sections[c.name]=e)},_renderStack:function(c,
b,e,d,f,g,h){(h=g)||(h=this.params.width-60);g=a.Node.create('<div class="stack-field stack-field-wrapper clear"></div>');f.append(g);c.width||(c.width=1);c["float"]&&g.setStyle("float",c["float"]);g.setStyle("width",Math.round(c.width*h)+"px");b!==e.length-1&&g.setStyle("paddingRight","30px");b=Math.round(c.width*h);this._renderFields(d,c.fields,g,b);c.hidden&&g.hide();c.name&&(this.sections[c.name]=g)},_renderField:function(c,b,e,d,f,g,h){var k;b=a.merge(c,c.config||{},{dialog:this,render:f});e=
b.name||c.name;this._debug.isTimingEnabled()&&this._debug.time("render field: "+e);a.Lang.isUndefined(b.data)&&(this.params.initialData&&!a.Lang.isUndefined(e))&&(b.data=this.params.initialData[e],b.panel=this);if(c.ctor)k=new c.ctor(b);else{if(!c.type)throw console.error("dialog: field type was",c.type,", and constructor was",c.ctor),console.error("dialog: config was",c),Error("Could not find field constructor or field type.");var l=this._convertToDialogField2Name(c.type),l=a.namespace("Squarespace.DialogFields")[l];
if(!l&&!a.Squarespace.DialogFieldGenerators[c.type])throw Error("Unknown field type: "+c.type);this._debug.log("Generating field type: ",c.type);l?k=new l(b):(console.log("Attempting to use DFG: ",c.type),k=new a.Squarespace.DialogFieldGenerators[c.type](c,this.params.initialData,this),k.type=c.type,k.append(f))}c.verticalSpan&&(this._verticalEl=k);c.countHeight&&!c.verticalSpan&&(k.getTakenHeight?this._takenHeight+=k.getTakenHeight():(this._takenHeight+=k.get("boundingBox").get("offsetHeight"),this._takenHeight+=
parseInt(k.get("boundingBox").getStyle("marginTop"),10),this._takenHeight+=parseInt(k.get("boundingBox").getStyle("marginBottom"),10)));g&&(this._isDialogField2(k)?(this._debug.log("setting width",h),k.get("boundingBox").setStyle("width",h+"px")):k.html&&(this._debug.log("setting width",h),k.html.setStyle("width",h+"px")));k.resize&&k.resize();c.hidden&&k.temporaryHide(!0);this._isDialogField2(k)?this.bodyEvents.push(k.on("dataStateChange",function(a){a=a.newVal;k.getProperty("DATA_STATES");this.fire("field-loading-change",
{field:k,loading:a===a.LOADING})},this)):this.bodyEvents.push(k.on("loadingChange",function(a){this.fire("field-loading-change",{field:k,loading:a.newVal})},this));k.getName()?this.fields[k.getName()]=k:this._noNameFields.push(k);d.tabFields.push(k);k.tab=d;this._debug.isTimingEnabled()&&this._debug.timeEnd("render field: "+e)},_isDialogField2:function(c){return a.Lang.isValue(c)&&a.Lang.isValue(a.Squarespace.DialogField2)&&c instanceof a.Squarespace.DialogField2},_setState:function(c){a.Lang.isValue(a.Squarespace.DialogStates[c])?
this.state=a.Squarespace.DialogStates[c]:console.warn("[Dialog] Invalid state.")},_isState:function(c){return a.Lang.isString(c)?this.state===a.Squarespace.DialogStates[c]:this.state===c},resizeVerticalFields:function(){a.Array.each(this.verticalFields,function(a,b){var e=this.getBodyHeight()-a._takenHeight;this._isDialogField2(a)?(e-=parseInt(a.get("boundingBox").getStyle("marginTop"),10),e-=parseInt(a.get("boundingBox").getStyle("marginBottom"),10),a.set("height",e)):a.setHeight(e)},this)},renderTab:function(c,
b){var e=a.Node.create('<div class="tab-wrapper"></div>');a.Lang.isValue(c.name)&&e.addClass("dialog-tab-"+c.name);e.setStyles({width:this.params.width+"px",left:b?"0px":this.params.width+"px"});this.bodyEl.append(e);c.tabFields=[];this._verticalEl=null;this._takenHeight=0;this._renderFields(c,c.fields||[],e);c.noTabTitle&&e.addClass("noTabTitle");if(this._verticalEl){var d=parseInt(e.getStyle("paddingTop"),10);isNaN(parseInt(e.getStyle("marginTop"),10))||(d+=parseInt(e.getStyle("marginTop"),10));
this._takenHeight+=d;var f=this._isDialogField2(this._verticalEl);!f&&!this._verticalEl.setHeight&&console.error("No setHeight for vertical el: ",this._verticalEl);d=this.getBodyHeight()-this._takenHeight;f?(f=this._verticalEl.get("boundingBox"),d-=parseInt(f.getStyle("marginTop"),10),d-=parseInt(f.getStyle("marginBottom"),10),this._verticalEl.set("height",d)):this._verticalEl.setHeight(d);this._verticalEl._takenHeight=this._takenHeight;this.verticalFields.push(this._verticalEl)}c.tabPanelObj=e;this.observedHeight+=
e.get("offsetHeight");b&&c.tabFields&&a.Array.forEach(c.tabFields,function(a){this._showField(a)},this);this.bodyEl.toggleClass("scrollable",!!c.scroll);b||e.addClass("hidden");return e},_convertToDialogField2Name:function(c){c=a.Squarespace.Utils.slugify(c).split("-");for(var b=c.length-1;0<=b;b--)c[b].capitalize&&(c[b]=c[b].capitalize());return c.join("")+"Field"},_destroyFields:function(){this.fields&&(a.Object.each(this.fields,function(a,b){a.destroy()},this),this._destroyNoNameFields());this.fields=
{}},_destroyNoNameFields:function(){a.Array.each(this._noNameFields,function(a){a&&a.destroy()},this);this._noNameFields=[]},destroyBody:function(){this.rendered=!1;this._destroyFields();this._isOverlayAnimationRunning()&&this.saveOverlayAnimationManager.destroy(!0);this.bodyEl&&this.bodyEl._node&&this.bodyEl.empty();a.Array.each(this.params.tabs,function(a){a.tabPanelObj=null;a.tabNavigationObj=null;a.tabFields=null});this._detachEventArray(this.bodyEvents);this.bodyEvents=[]},_detachEventArray:function(c){a.Array.each(c,
function(a){a.detach()})},destroyButtons:function(){this._detachEventArray(this.buttonEvents);this.buttonEvents=[];this.buttonHolder&&this.buttonHolder._node&&this.buttonHolder.set("innerHTML","")},_destroy:function(){this.preDestroyCalled||this._preDestroy();this.bodyHeight=this.currentErrors=this.destroyTimer=null;this.destroyBody();this.destroyButtons();this.overlayEl&&!this.overlayEl.destroying&&(this.overlayEl.remove(),this.overlayEl=null);this._onBeforeUnloadEvt&&this._onBeforeUnloadEvt.detach();
this._detachEventArray(this.globalEvents);this.dd&&(this.dd.destroy(),this.dd=null);this.globalEvents=[];this.el&&(this.el.remove(!0),this.bodyEl=this.el=null);this.params.parentDialog&&(this.params.parentDialog.removeChildDialog(this),this.params.parentDialog=null);this._setState("CLOSED");this.anchorEl=this.position=null}});a.augment(a.Squarespace.EditingDialog,a.EventTarget)},"1.0",{requires:"anim attribute datatype-date dd json node node-event-simulate node-focusmanager squarespace-animation-manager squarespace-beforeunload squarespace-debugger squarespace-dialog-field-2 squarespace-dialog-fields squarespace-dialog-legacy-multi-frame squarespace-escmanager squarespace-gizmo squarespace-plugin-scroll-lock squarespace-ui-base squarespace-widgets-confirmation thirdparty-jstween transition".split(" ")});
YUI.add("dd-ddm-base",function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments)};b.NAME="ddm";b.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},clickTimeThresh:{value:1E3},throttleTime:{value:-1},dragMode:{value:"point",setter:function(a){this._setDragMode(a);return a}}};a.extend(b,a.Base,{_createPG:function(){},_active:null,_setDragMode:function(b){null===b&&(b=a.DD.DDM.get("dragMode"));switch(b){case 1:case "intersect":return 1;case 2:case "strict":return 2}return 0},
CSS_PREFIX:a.ClassNameManager.getClassName("dd"),_activateTargets:function(){},_drags:[],activeDrag:!1,_regDrag:function(a){if(this.getDrag(a.get("node")))return!1;this._active||this._setupListeners();this._drags.push(a);return!0},_unregDrag:function(b){var d=[];a.Array.each(this._drags,function(a){a!==b&&(d[d.length]=a)});this._drags=d},_setupListeners:function(){this._createPG();this._active=!0;var b=a.one(a.config.doc);b.on("mousemove",a.throttle(a.bind(this._docMove,this),this.get("throttleTime")));
b.on("mouseup",a.bind(this._end,this))},_start:function(){this.fire("ddm:start");this._startDrag()},_startDrag:function(){},_endDrag:function(){},_dropMove:function(){},_end:function(){this.activeDrag&&(this._shimming=!1,this._endDrag(),this.fire("ddm:end"),this.activeDrag.end.call(this.activeDrag),this.activeDrag=null)},stopDrag:function(){this.activeDrag&&this._end();return this},_shimming:!1,_docMove:function(a){this._shimming||this._move(a)},_move:function(a){this.activeDrag&&(this.activeDrag._move.call(this.activeDrag,
a),this._dropMove())},cssSizestoObject:function(a){a=a.split(" ");switch(a.length){case 1:a[1]=a[2]=a[3]=a[0];break;case 2:a[2]=a[0];a[3]=a[1];break;case 3:a[3]=a[1]}return{top:parseInt(a[0],10),right:parseInt(a[1],10),bottom:parseInt(a[2],10),left:parseInt(a[3],10)}},getDrag:function(b){var d=!1,f=a.one(b);f instanceof a.Node&&a.Array.each(this._drags,function(a){f.compareTo(a.get("node"))&&(d=a)});return d},swapPosition:function(b,d){b=a.DD.DDM.getNode(b);d=a.DD.DDM.getNode(d);var f=b.getXY(),c=
d.getXY();b.setXY(c);d.setXY(f);return b},getNode:function(b){return b instanceof a.Node?b:b=b&&b.get?a.Widget&&b instanceof a.Widget?b.get("boundingBox"):b.get("node"):a.one(b)},swapNode:function(b,d){b=a.DD.DDM.getNode(b);d=a.DD.DDM.getNode(d);var f=d.get("parentNode"),c=d.get("nextSibling");c===b?f.insertBefore(b,d):d===b.get("nextSibling")?f.insertBefore(d,b):(b.get("parentNode").replaceChild(d,b),f.insertBefore(b,c));return b}});a.namespace("DD");a.DD.DDM=new b},"3.17.2",{requires:["node","base",
"yui-throttle","classnamemanager"]});
YUI.add("dd-ddm",function(a,c){a.mix(a.DD.DDM,{_pg:null,_debugShim:!1,_activateTargets:function(){},_deactivateTargets:function(){},_startDrag:function(){this.activeDrag&&this.activeDrag.get("useShim")&&(this._shimming=!0,this._pg_activate(),this._activateTargets())},_endDrag:function(){this._pg_deactivate();this._deactivateTargets()},_pg_deactivate:function(){this._pg.setStyle("display","none")},_pg_activate:function(){this._pg||this._createPG();var a=this.activeDrag.get("activeHandle"),c="auto";
a&&(c=a.getStyle("cursor"));"auto"===c&&(c=this.get("dragCursor"));this._pg_size();this._pg.setStyles({top:0,left:0,display:"block",opacity:this._debugShim?".5":"0",cursor:c})},_pg_size:function(){if(this.activeDrag){var b=a.one("body"),c=b.get("docHeight"),b=b.get("docWidth");this._pg.setStyles({height:c+"px",width:b+"px"})}},_createPG:function(){var b=a.Node.create("<div></div>"),c=a.one("body");b.setStyles({top:"0",left:"0",position:"absolute",zIndex:"9999",overflow:"hidden",backgroundColor:"red",
display:"none",height:"5px",width:"5px"});b.set("id",a.stamp(b));b.addClass(a.DD.DDM.CSS_PREFIX+"-shim");c.prepend(b);this._pg=b;this._pg.on("mousemove",a.throttle(a.bind(this._move,this),this.get("throttleTime")));this._pg.on("mouseup",a.bind(this._end,this));b=a.one("win");a.on("window:resize",a.bind(this._pg_size,this));b.on("scroll",a.bind(this._pg_size,this))}},!0)},"3.17.2",{requires:["dd-ddm-base","event-resize"]});
YUI.add("dd-ddm-drop",function(a,c){a.mix(a.DD.DDM,{_noShim:!1,_activeShims:[],_hasActiveShim:function(){return this._noShim?!0:this._activeShims.length},_addActiveShim:function(a){this._activeShims.push(a)},_removeActiveShim:function(b){var c=[];a.Array.each(this._activeShims,function(a){a._yuid!==b._yuid&&c.push(a)});this._activeShims=c},syncActiveShims:function(b){a.later(0,this,function(b){b=b?this.targets:this._lookup();a.Array.each(b,function(a){a.sizeShim.call(a)},this)},b)},mode:0,POINT:0,
INTERSECT:1,STRICT:2,useHash:!0,activeDrop:null,validDrops:[],otherDrops:{},targets:[],_addValid:function(a){this.validDrops.push(a);return this},_removeValid:function(b){var c=[];a.Array.each(this.validDrops,function(a){a!==b&&c.push(a)});this.validDrops=c;return this},isOverTarget:function(a){if(this.activeDrag&&a){var c=this.activeDrag.mouseXY,d=this.activeDrag.get("dragMode"),f,g=a.shim;if(c&&this.activeDrag){f=this.activeDrag.region;if(d===this.STRICT)return this.activeDrag.get("dragNode").inRegion(a.region,
!0,f);if(a&&a.shim){if(d===this.INTERSECT&&this._noShim)return c=f||this.activeDrag.get("node"),a.get("node").intersect(c,a.region).inRegion;this._noShim&&(g=a.get("node"));return g.intersect({top:c[1],bottom:c[1],left:c[0],right:c[0]},a.region).inRegion}}}return!1},clearCache:function(){this.validDrops=[];this.otherDrops={};this._activeShims=[]},_activateTargets:function(){this._noShim=!0;this.clearCache();a.Array.each(this.targets,function(a){a._activateShim([]);!0===a.get("noShim")&&(this._noShim=
!1)},this);this._handleTargetOver()},getBestMatch:function(b,c){var d=null,f=0,g;a.Object.each(b,function(a){var b=this.activeDrag.get("dragNode").intersect(a.get("node"));a.region.area=b.area;b.inRegion&&b.area>f&&(f=b.area,d=a)},this);return c?(g=[],a.Object.each(b,function(a){a!==d&&g.push(a)},this),[d,g]):d},_deactivateTargets:function(){var b=[],c=this.activeDrag,d=this.activeDrop;c&&d&&this.otherDrops[d]?(c.get("dragMode")?(b=this.getBestMatch(this.otherDrops,!0),d=b[0],b=b[1]):(b=this.otherDrops,
delete b[d]),c.get("node").removeClass(this.CSS_PREFIX+"-drag-over"),d&&(d.fire("drop:hit",{drag:c,drop:d,others:b}),c.fire("drag:drophit",{drag:c,drop:d,others:b}))):c&&c.get("dragging")&&(c.get("node").removeClass(this.CSS_PREFIX+"-drag-over"),c.fire("drag:dropmiss",{pageX:c.lastXY[0],pageY:c.lastXY[1]}));this.activeDrop=null;a.Array.each(this.targets,function(a){a._deactivateShim([])},this)},_dropMove:function(){this._hasActiveShim()?this._handleTargetOver():a.Object.each(this.otherDrops,function(a){a._handleOut.apply(a,
[])})},_lookup:function(){if(!this.useHash||this._noShim)return this.validDrops;var b=[];a.Array.each(this.validDrops,function(a){a.shim&&a.shim.inViewportRegion(!1,a.region)&&b.push(a)});return b},_handleTargetOver:function(){var b=this._lookup();a.Array.each(b,function(a){a._handleTargetOver.call(a)},this)},_regTarget:function(a){this.targets.push(a)},_unregTarget:function(b){var c=[],d;a.Array.each(this.targets,function(a){a!==b&&c.push(a)},this);this.targets=c;d=[];a.Array.each(this.validDrops,
function(a){a!==b&&d.push(a)});this.validDrops=d},getDrop:function(b){var c=!1,d=a.one(b);d instanceof a.Node&&a.Array.each(this.targets,function(a){d.compareTo(a.get("node"))&&(c=a)});return c}},!0)},"3.17.2",{requires:["dd-ddm"]});
YUI.add("dd-drag",function(a,c){var b=a.DD.DDM,e=function(d){this._lazyAddAttrs=!1;e.superclass.constructor.apply(this,arguments);b._regDrag(this)||a.error("Failed to register node, already in use: "+d.node)};e.NAME="drag";e.START_EVENT="mousedown";e.ATTRS={node:{setter:function(d){if(this._canDrag(d))return d;var b=a.one(d);b||a.error("DD.Drag: Invalid Node Given: "+d);return b}},dragNode:{setter:function(d){if(this._canDrag(d))return d;var b=a.one(d);b||a.error("DD.Drag: Invalid dragNode Given: "+
d);return b}},offsetNode:{value:!0},startCentered:{value:!1},clickPixelThresh:{value:b.get("clickPixelThresh")},clickTimeThresh:{value:b.get("clickTimeThresh")},lock:{value:!1,setter:function(a){a?this.get("node").addClass(b.CSS_PREFIX+"-locked"):this.get("node").removeClass(b.CSS_PREFIX+"-locked");return a}},data:{value:!1},move:{value:!0},useShim:{value:!0},activeHandle:{value:!1},primaryButtonOnly:{value:!0},dragging:{value:!1},parent:{value:!1},target:{value:!1,setter:function(a){this._handleTarget(a);
return a}},dragMode:{value:null,setter:function(a){return b._setDragMode(a)}},groups:{value:["default"],getter:function(){return!this._groups?(this._groups={},[]):a.Object.keys(this._groups)},setter:function(d){this._groups=a.Array.hash(d);return d}},handles:{value:null,setter:function(d){d?(this._handles={},a.Array.each(d,function(d){var b=d;if(d instanceof a.Node||d instanceof a.NodeList)b=d._yuid;this._handles[b]=d},this)):this._handles=null;return d}},bubbles:{setter:function(a){this.addTarget(a);
return a}},haltDown:{value:!0}};a.extend(e,a.Base,{_canDrag:function(a){return a&&a.setXY&&a.getXY&&a.test&&a.contains?!0:!1},_bubbleTargets:a.DD.DDM,addToGroup:function(a){this._groups[a]=!0;b._activateTargets();return this},removeFromGroup:function(a){delete this._groups[a];b._activateTargets();return this},target:null,_handleTarget:function(d){a.DD.Drop&&(!1===d?this.target&&(b._unregTarget(this.target),this.target=null):(a.Lang.isObject(d)||(d={}),d.bubbleTargets=d.bubbleTargets||this.getTargets(),
d.node=this.get("node"),d.groups=d.groups||this.get("groups"),this.target=new a.DD.Drop(d)))},_groups:null,_createEvents:function(){this.publish("drag:mouseDown",{defaultFn:this._defMouseDownFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:align",{defaultFn:this._defAlignFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:drag",{defaultFn:this._defDragFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});this.publish("drag:end",{defaultFn:this._defEndFn,
preventedFn:this._prevEndFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"});a.Array.each("drag:afterMouseDown drag:removeHandle drag:addHandle drag:removeInvalid drag:addInvalid drag:start drag:drophit drag:dropmiss drag:over drag:enter drag:exit".split(" "),function(a){this.publish(a,{type:a,emitFacade:!0,bubbles:!0,preventable:!1,queuable:!1,prefix:"drag"})},this)},_ev_md:null,_startTime:null,_endTime:null,_handles:null,_invalids:null,_invalidsDefault:{textarea:!0,input:!0,a:!0,button:!0,select:!0},
_dragThreshMet:null,_fromTimeout:null,_clickTimeout:null,deltaXY:null,startXY:null,nodeXY:null,lastXY:null,actXY:null,realXY:null,mouseXY:null,region:null,_handleMouseUp:function(){this.fire("drag:mouseup");this._fixIEMouseUp();b.activeDrag&&b._end()},_fixDragStart:function(a){this.validClick(a)&&a.preventDefault()},_ieSelectFix:function(){return!1},_ieSelectBack:null,_fixIEMouseDown:function(){a.UA.ie&&(this._ieSelectBack=a.config.doc.body.onselectstart,a.config.doc.body.onselectstart=this._ieSelectFix)},
_fixIEMouseUp:function(){a.UA.ie&&(a.config.doc.body.onselectstart=this._ieSelectBack)},_handleMouseDownEvent:function(a){this.validClick(a)&&a.preventDefault();this.fire("drag:mouseDown",{ev:a})},_defMouseDownFn:function(d){d=d.ev;this._dragThreshMet=!1;this._ev_md=d;if(this.get("primaryButtonOnly")&&1<d.button)return!1;this.validClick(d)&&(this._fixIEMouseDown(d),0!==e.START_EVENT.indexOf("gesture")&&(this.get("haltDown")?d.halt():d.preventDefault()),this._setStartPosition([d.pageX,d.pageY]),b.activeDrag=
this,this._clickTimeout=a.later(this.get("clickTimeThresh"),this,this._timeoutCheck));this.fire("drag:afterMouseDown",{ev:d})},validClick:function(d){var b=!1,c=!1,h=d.target,e=null,l=c=null,m=!1;if(this._handles)a.Object.each(this._handles,function(d,c){d instanceof a.Node||d instanceof a.NodeList?b||(l=d,l instanceof a.Node&&(l=new a.NodeList(d._node)),l.each(function(a){a.contains(h)&&(b=!0)})):a.Lang.isString(c)&&(h.test(c+", "+c+" *")&&!e)&&(e=c,b=!0)});else if(c=this.get("node"),c.contains(h)||
c.compareTo(h))b=!0;b&&this._invalids&&a.Object.each(this._invalids,function(d,c){a.Lang.isString(c)&&h.test(c+", "+c+" *")&&(b=!1)});b&&(e?(c=d.currentTarget.all(e),m=!1,c.each(function(a){if((a.contains(h)||a.compareTo(h))&&!m)m=!0,this.set("activeHandle",a)},this)):this.set("activeHandle",this.get("node")));return b},_setStartPosition:function(a){this.startXY=a;this.nodeXY=this.lastXY=this.realXY=this.get("node").getXY();this.get("offsetNode")?this.deltaXY=[this.startXY[0]-this.nodeXY[0],this.startXY[1]-
this.nodeXY[1]]:this.deltaXY=[0,0]},_timeoutCheck:function(){!this.get("lock")&&(!this._dragThreshMet&&this._ev_md)&&(this._fromTimeout=this._dragThreshMet=!0,this.start(),this._alignNode([this._ev_md.pageX,this._ev_md.pageY],!0))},removeHandle:function(d){var b=d;if(d instanceof a.Node||d instanceof a.NodeList)b=d._yuid;this._handles[b]&&(delete this._handles[b],this.fire("drag:removeHandle",{handle:d}));return this},addHandle:function(d){this._handles||(this._handles={});var b=d;if(d instanceof
a.Node||d instanceof a.NodeList)b=d._yuid;this._handles[b]=d;this.fire("drag:addHandle",{handle:d});return this},removeInvalid:function(a){this._invalids[a]&&(this._invalids[a]=null,delete this._invalids[a],this.fire("drag:removeInvalid",{handle:a}));return this},addInvalid:function(d){a.Lang.isString(d)&&(this._invalids[d]=!0,this.fire("drag:addInvalid",{handle:d}));return this},initializer:function(){this.get("node").dd=this;if(!this.get("node").get("id")){var d=a.stamp(this.get("node"));this.get("node").set("id",
d)}this.actXY=[];this._invalids=a.clone(this._invalidsDefault,!0);this._createEvents();this.get("dragNode")||this.set("dragNode",this.get("node"));this.on("initializedChange",a.bind(this._prep,this));this.set("groups",this.get("groups"))},_prep:function(){this._dragThreshMet=!1;var d=this.get("node");d.addClass(b.CSS_PREFIX+"-draggable");d.on(e.START_EVENT,a.bind(this._handleMouseDownEvent,this));d.on("mouseup",a.bind(this._handleMouseUp,this));d.on("dragstart",a.bind(this._fixDragStart,this))},_unprep:function(){var a=
this.get("node");a.removeClass(b.CSS_PREFIX+"-draggable");a.detachAll("mouseup");a.detachAll("dragstart");a.detachAll(e.START_EVENT);this.mouseXY=[];this.deltaXY=[0,0];this.startXY=[];this.nodeXY=[];this.lastXY=[];this.actXY=[];this.realXY=[]},start:function(){if(!this.get("lock")&&!this.get("dragging")){var a=this.get("node"),f,c;this._startTime=(new Date).getTime();b._start();a.addClass(b.CSS_PREFIX+"-dragging");this.fire("drag:start",{pageX:this.nodeXY[0],pageY:this.nodeXY[1],startTime:this._startTime});
a=this.get("dragNode");c=this.nodeXY;f=a.get("offsetWidth");a=a.get("offsetHeight");this.get("startCentered")&&this._setStartPosition([c[0]+f/2,c[1]+a/2]);this.region={0:c[0],1:c[1],area:0,top:c[1],right:c[0]+f,bottom:c[1]+a,left:c[0]};this.set("dragging",!0)}return this},end:function(){this._endTime=(new Date).getTime();this._clickTimeout&&this._clickTimeout.cancel();this._dragThreshMet=this._fromTimeout=!1;!this.get("lock")&&this.get("dragging")&&this.fire("drag:end",{pageX:this.lastXY[0],pageY:this.lastXY[1],
startTime:this._startTime,endTime:this._endTime});this.get("node").removeClass(b.CSS_PREFIX+"-dragging");this.set("dragging",!1);this.deltaXY=[0,0];return this},_defEndFn:function(){this._fixIEMouseUp();this._ev_md=null},_prevEndFn:function(){this._fixIEMouseUp();this.get("dragNode").setXY(this.nodeXY);this.region=this._ev_md=null},_align:function(a){this.fire("drag:align",{pageX:a[0],pageY:a[1]})},_defAlignFn:function(a){this.actXY=[a.pageX-this.deltaXY[0],a.pageY-this.deltaXY[1]]},_alignNode:function(a,
b){this._align(a);b||this._moveNode()},_moveNode:function(a){var b=[],c=[],h=this.nodeXY,e=this.actXY;b[0]=e[0]-this.lastXY[0];b[1]=e[1]-this.lastXY[1];c[0]=e[0]-this.nodeXY[0];c[1]=e[1]-this.nodeXY[1];this.region={0:e[0],1:e[1],area:0,top:e[1],right:e[0]+this.get("dragNode").get("offsetWidth"),bottom:e[1]+this.get("dragNode").get("offsetHeight"),left:e[0]};this.fire("drag:drag",{pageX:e[0],pageY:e[1],scroll:a,info:{start:h,xy:e,delta:b,offset:c}});this.lastXY=e},_defDragFn:function(d){if(this.get("move")){if(d.scroll&&
d.scroll.node){var b=d.scroll.node.getDOMNode();b===a.config.win?b.scrollTo(d.scroll.left,d.scroll.top):(d.scroll.node.set("scrollTop",d.scroll.top),d.scroll.node.set("scrollLeft",d.scroll.left))}this.get("dragNode").setXY([d.pageX,d.pageY]);this.realXY=[d.pageX,d.pageY]}},_move:function(a){if(this.get("lock"))return!1;this.mouseXY=[a.pageX,a.pageY];if(this._dragThreshMet)this._clickTimeout&&this._clickTimeout.cancel(),this._alignNode([a.pageX,a.pageY]);else{var b=Math.abs(this.startXY[0]-a.pageX),
c=Math.abs(this.startXY[1]-a.pageY);if(b>this.get("clickPixelThresh")||c>this.get("clickPixelThresh"))this._dragThreshMet=!0,this.start(),a&&a.preventDefault&&a.preventDefault(),this._alignNode([a.pageX,a.pageY])}},stopDrag:function(){this.get("dragging")&&b._end();return this},destructor:function(){this._unprep();this.target&&this.target.destroy();b._unregDrag(this)}});a.namespace("DD");a.DD.Drag=e},"3.17.2",{requires:["dd-ddm-base"]});
YUI.add("dd-proxy",function(a,c){var b=a.DD.DDM,e=function(){e.superclass.constructor.apply(this,arguments)};e.NAME="DDProxy";e.NS="proxy";e.ATTRS={host:{},moveOnEnd:{value:!0},hideOnEnd:{value:!0},resizeFrame:{value:!0},positionProxy:{value:!0},borderStyle:{value:"1px solid #808080"},cloneNode:{value:!1}};a.namespace("Plugin");a.extend(e,a.Base,{_hands:null,_init:function(){if(b._proxy){this._hands||(this._hands=[]);var d,c,g=this.get("host");g.get("dragNode").compareTo(g.get("node"))&&b._proxy&&
g.set("dragNode",b._proxy);a.Array.each(this._hands,function(a){a.detach()});d=b.on("ddm:start",a.bind(function(){b.activeDrag===g&&b._setFrame(g)},this));c=b.on("ddm:end",a.bind(function(){g.get("dragging")&&(this.get("moveOnEnd")&&g.get("node").setXY(g.lastXY),this.get("hideOnEnd")&&g.get("dragNode").setStyle("display","none"),this.get("cloneNode")&&(g.get("dragNode").remove(),g.set("dragNode",b._proxy)))},this));this._hands=[d,c]}else b._createFrame(),a.on("domready",a.bind(this._init,this))},
initializer:function(){this._init()},destructor:function(){var b=this.get("host");a.Array.each(this._hands,function(a){a.detach()});b.set("dragNode",b.get("node"))},clone:function(){var b=this.get("host"),c=b.get("node"),g=c.cloneNode(!0);g.all('input[type="radio"]').removeAttribute("name");delete g._yuid;g.setAttribute("id",a.guid());g.setStyle("position","absolute");c.get("parentNode").appendChild(g);b.set("dragNode",g);return g}});a.Plugin.DDProxy=e;a.mix(b,{_createFrame:function(){if(!b._proxy){b._proxy=
!0;var d=a.Node.create("<div></div>"),c=a.one("body");d.setStyles({position:"absolute",display:"none",zIndex:"999",top:"-999px",left:"-999px"});c.prepend(d);d.set("id",a.guid());d.addClass(b.CSS_PREFIX+"-proxy");b._proxy=d}},_setFrame:function(a){var c=a.get("node"),g=a.get("dragNode"),h,e="auto";(h=b.activeDrag.get("activeHandle"))&&(e=h.getStyle("cursor"));"auto"===e&&(e=b.get("dragCursor"));g.setStyles({visibility:"hidden",display:"block",cursor:e,border:a.proxy.get("borderStyle")});a.proxy.get("cloneNode")&&
(g=a.proxy.clone());a.proxy.get("resizeFrame")&&g.setStyles({height:c.get("offsetHeight")+"px",width:c.get("offsetWidth")+"px"});a.proxy.get("positionProxy")&&g.setXY(a.nodeXY);g.setStyle("visibility","visible")}})},"3.17.2",{requires:["dd-drag"]});
YUI.add("dd-constrain",function(a,c){var b=a.DD.DDM,e=null,d=function(){this._lazyAddAttrs=!1;d.superclass.constructor.apply(this,arguments)};d.NAME="ddConstrained";d.NS="con";d.ATTRS={host:{},stickX:{value:!1},stickY:{value:!1},tickX:{value:!1},tickY:{value:!1},tickXArray:{value:!1},tickYArray:{value:!1},gutter:{value:"0",setter:function(b){return a.DD.DDM.cssSizestoObject(b)}},constrain:{value:"view",setter:function(b){var d=a.one(b);d&&(b=d);return b}},constrain2region:{setter:function(a){return this.set("constrain",
a)}},constrain2node:{setter:function(b){return this.set("constrain",a.one(b))}},constrain2view:{setter:function(){return this.set("constrain","view")}},cacheRegion:{value:!0}};e={_lastTickXFired:null,_lastTickYFired:null,initializer:function(){this._createEvents();this._eventHandles=[this.get("host").on("drag:end",a.bind(this._handleEnd,this)),this.get("host").on("drag:start",a.bind(this._handleStart,this)),this.get("host").after("drag:align",a.bind(this.align,this)),this.get("host").after("drag:drag",
a.bind(this.drag,this))]},destructor:function(){a.Array.each(this._eventHandles,function(a){a.detach()});this._eventHandles.length=0},_createEvents:function(){a.Array.each(["drag:tickAlignX","drag:tickAlignY"],function(a){this.publish(a,{type:a,emitFacade:!0,bubbles:!0,queuable:!1,prefix:"drag"})},this)},_handleEnd:function(){this._lastTickXFired=this._lastTickYFired=null},_handleStart:function(){this.resetCache()},_regionCache:null,_cacheRegion:function(){this._regionCache=this.get("constrain").get("region")},
resetCache:function(){this._regionCache=null},_getConstraint:function(){var b=this.get("constrain"),d=this.get("gutter"),c;b&&(b instanceof a.Node?(this._regionCache||(this._eventHandles.push(a.on("resize",a.bind(this._cacheRegion,this),a.config.win)),this._cacheRegion()),c=a.clone(this._regionCache),this.get("cacheRegion")||this.resetCache()):a.Lang.isObject(b)&&(c=a.clone(b)));if(!b||!c)b="view";"view"===b&&(c=this.get("host").get("dragNode").get("viewportRegion"));a.Object.each(d,function(a,b){c[b]=
"right"===b||"bottom"===b?c[b]-a:c[b]+a});return c},getRegion:function(a){var b={},d=null,c=null,c=this.get("host"),b=this._getConstraint();a&&(d=c.get("dragNode").get("offsetHeight"),c=c.get("dragNode").get("offsetWidth"),b.right-=c,b.bottom-=d);return b},_checkRegion:function(a){var b=this.getRegion(),d=this.get("host"),c=d.get("dragNode").get("offsetHeight"),d=d.get("dragNode").get("offsetWidth");a[1]>b.bottom-c&&(a[1]=b.bottom-c);b.top>a[1]&&(a[1]=b.top);a[0]>b.right-d&&(a[0]=b.right-d);b.left>
a[0]&&(a[0]=b.left);return a},inRegion:function(a){a=a||this.get("host").get("dragNode").getXY();var b=this._checkRegion([a[0],a[1]]),d=!1;a[0]===b[0]&&a[1]===b[1]&&(d=!0);return d},align:function(){var a=this.get("host"),b=[a.actXY[0],a.actXY[1]],d=this.getRegion(!0);this.get("stickX")&&(b[1]=a.startXY[1]-a.deltaXY[1]);this.get("stickY")&&(b[0]=a.startXY[0]-a.deltaXY[0]);d&&(b=this._checkRegion(b));b=this._checkTicks(b,d);a.actXY=b},drag:function(){var b=this.get("host"),d=this.get("tickX"),c=this.get("tickY"),
b=[b.actXY[0],b.actXY[1]];if((a.Lang.isNumber(d)||this.get("tickXArray"))&&this._lastTickXFired!==b[0])this._tickAlignX(),this._lastTickXFired=b[0];if((a.Lang.isNumber(c)||this.get("tickYArray"))&&this._lastTickYFired!==b[1])this._tickAlignY(),this._lastTickYFired=b[1]},_checkTicks:function(a,d){var c=this.get("host"),e=c.startXY[0]-c.deltaXY[0],c=c.startXY[1]-c.deltaXY[1],l=this.get("tickX"),m=this.get("tickY");l&&!this.get("tickXArray")&&(a[0]=b._calcTicks(a[0],e,l,d.left,d.right));m&&!this.get("tickYArray")&&
(a[1]=b._calcTicks(a[1],c,m,d.top,d.bottom));this.get("tickXArray")&&(a[0]=b._calcTickArray(a[0],this.get("tickXArray"),d.left,d.right));this.get("tickYArray")&&(a[1]=b._calcTickArray(a[1],this.get("tickYArray"),d.top,d.bottom));return a},_tickAlignX:function(){this.fire("drag:tickAlignX")},_tickAlignY:function(){this.fire("drag:tickAlignY")}};a.namespace("Plugin");a.extend(d,a.Base,e);a.Plugin.DDConstrained=d;a.mix(b,{_calcTicks:function(a,b,d,c,e){var m=(a-b)/d,p=Math.floor(m),n=Math.ceil(m);if((0!==
p||0!==n)&&m>=p&&m<=n)a=b+d*p,c&&e&&(a<c&&(a=b+d*(p+1)),a>e&&(a=b+d*(p-1)));return a},_calcTickArray:function(a,b,d,c){var e=0,m=b.length,p=0,n;if(!b||0===b.length)return a;if(b[0]>=a)return b[0];for(e=0;e<m;e++)if(p=e+1,b[p]&&b[p]>=a)return n=a-b[e],a=b[p]-a,p=a>n?b[e]:b[p],d&&c&&p>c&&(p=b[e]?b[e]:b[m-1]),p;return b[b.length-1]}})},"3.17.2",{requires:["dd-drag"]});
YUI.add("dd-drop",function(a,c){var b=a.DD.DDM,e=function(){this._lazyAddAttrs=!1;e.superclass.constructor.apply(this,arguments);a.on("domready",a.bind(function(){a.later(100,this,this._createShim)},this));b._regTarget(this)};e.NAME="drop";e.ATTRS={node:{setter:function(b){var c=a.one(b);c||a.error("DD.Drop: Invalid Node Given: "+b);return c}},groups:{value:["default"],getter:function(){return!this._groups?(this._groups={},[]):a.Object.keys(this._groups)},setter:function(b){this._groups=a.Array.hash(b);
return b}},padding:{value:"0",setter:function(a){return b.cssSizestoObject(a)}},lock:{value:!1,setter:function(a){a?this.get("node").addClass(b.CSS_PREFIX+"-drop-locked"):this.get("node").removeClass(b.CSS_PREFIX+"-drop-locked");return a}},bubbles:{setter:function(a){this.addTarget(a);return a}},useShim:{value:!0,setter:function(b){a.DD.DDM._noShim=!b;return b}}};a.extend(e,a.Base,{_bubbleTargets:a.DD.DDM,addToGroup:function(a){this._groups[a]=!0;return this},removeFromGroup:function(a){delete this._groups[a];
return this},_createEvents:function(){a.Array.each(["drop:over","drop:enter","drop:exit","drop:hit"],function(a){this.publish(a,{type:a,emitFacade:!0,preventable:!1,bubbles:!0,queuable:!1,prefix:"drop"})},this)},_valid:null,_groups:null,shim:null,region:null,overTarget:null,inGroup:function(b){var c=this._valid=!1;a.Array.each(b,function(a){this._groups[a]&&(this._valid=c=!0)},this);return c},initializer:function(){a.later(100,this,this._createEvents);var d=this.get("node"),c;d.get("id")||(c=a.stamp(d),
d.set("id",c));d.addClass(b.CSS_PREFIX+"-drop");this.set("groups",this.get("groups"))},destructor:function(){b._unregTarget(this);this.shim&&this.shim!==this.get("node")&&(this.shim.detachAll(),this.shim.remove(),this.shim=null);this.get("node").removeClass(b.CSS_PREFIX+"-drop");this.detachAll()},_deactivateShim:function(){if(!this.shim)return!1;this.get("node").removeClass(b.CSS_PREFIX+"-drop-active-valid");this.get("node").removeClass(b.CSS_PREFIX+"-drop-active-invalid");this.get("node").removeClass(b.CSS_PREFIX+
"-drop-over");this.get("useShim")&&this.shim.setStyles({top:"-999px",left:"-999px",zIndex:"1"});this.overTarget=!1},_activateShim:function(){if(!b.activeDrag||this.get("node")===b.activeDrag.get("node")||this.get("lock"))return!1;var a=this.get("node");this.inGroup(b.activeDrag.get("groups"))?(a.removeClass(b.CSS_PREFIX+"-drop-active-invalid"),a.addClass(b.CSS_PREFIX+"-drop-active-valid"),b._addValid(this),this.overTarget=!1,this.get("useShim")||(this.shim=this.get("node")),this.sizeShim()):(b._removeValid(this),
a.removeClass(b.CSS_PREFIX+"-drop-active-valid"),a.addClass(b.CSS_PREFIX+"-drop-active-invalid"))},sizeShim:function(){if(!b.activeDrag||this.get("node")===b.activeDrag.get("node")||this.get("lock"))return!1;if(!this.shim)return a.later(100,this,this.sizeShim),!1;var d=this.get("node"),c=d.get("offsetHeight"),e=d.get("offsetWidth"),d=d.getXY(),h=this.get("padding"),k,l,e=e+h.left+h.right,c=c+h.top+h.bottom;d[0]-=h.left;d[1]-=h.top;b.activeDrag.get("dragMode")===b.INTERSECT&&(h=b.activeDrag,k=h.get("node").get("offsetHeight"),
l=h.get("node").get("offsetWidth"),c+=k,e+=l,d[0]-=l-h.deltaXY[0],d[1]-=k-h.deltaXY[1]);this.get("useShim")&&this.shim.setStyles({height:c+"px",width:e+"px",top:d[1]+"px",left:d[0]+"px"});this.region={0:d[0],1:d[1],area:0,top:d[1],right:d[0]+e,bottom:d[1]+c,left:d[0]}},_createShim:function(){if(b._pg){if(!this.shim){var d=this.get("node");this.get("useShim")&&(d=a.Node.create('<div id="'+this.get("node").get("id")+'_shim"></div>'),d.setStyles({height:this.get("node").get("offsetHeight")+"px",width:this.get("node").get("offsetWidth")+
"px",backgroundColor:"yellow",opacity:".5",zIndex:"1",overflow:"hidden",top:"-900px",left:"-900px",position:"absolute"}),b._pg.appendChild(d),d.on("mouseover",a.bind(this._handleOverEvent,this)),d.on("mouseout",a.bind(this._handleOutEvent,this)));this.shim=d}}else a.later(10,this,this._createShim)},_handleTargetOver:function(){b.isOverTarget(this)?(this.get("node").addClass(b.CSS_PREFIX+"-drop-over"),b.activeDrop=this,b.otherDrops[this]=this,this.overTarget?(b.activeDrag.fire("drag:over",{drop:this,
drag:b.activeDrag}),this.fire("drop:over",{drop:this,drag:b.activeDrag})):b.activeDrag.get("dragging")&&(this.overTarget=!0,this.fire("drop:enter",{drop:this,drag:b.activeDrag}),b.activeDrag.fire("drag:enter",{drop:this,drag:b.activeDrag}),b.activeDrag.get("node").addClass(b.CSS_PREFIX+"-drag-over"))):this._handleOut()},_handleOverEvent:function(){this.shim.setStyle("zIndex","999");b._addActiveShim(this)},_handleOutEvent:function(){this.shim.setStyle("zIndex","1");b._removeActiveShim(this)},_handleOut:function(a){if((!b.isOverTarget(this)||
a)&&this.overTarget)this.overTarget=!1,a||b._removeActiveShim(this),b.activeDrag&&(this.get("node").removeClass(b.CSS_PREFIX+"-drop-over"),b.activeDrag.get("node").removeClass(b.CSS_PREFIX+"-drag-over"),this.fire("drop:exit",{drop:this,drag:b.activeDrag}),b.activeDrag.fire("drag:exit",{drop:this,drag:b.activeDrag}),delete b.otherDrops[this])}});a.DD.Drop=e},"3.17.2",{requires:["dd-drag","dd-ddm-drop"]});
YUI.add("dd-scroll",function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments)},e,d;b.ATTRS={parentScroll:{value:!1,setter:function(a){return a?a:!1}},buffer:{value:30,validator:a.Lang.isNumber},scrollDelay:{value:235,validator:a.Lang.isNumber},host:{value:null},windowScroll:{value:!1,validator:a.Lang.isBoolean},vertical:{value:!0,validator:a.Lang.isBoolean},horizontal:{value:!0,validator:a.Lang.isBoolean}};a.extend(b,a.Base,{_scrolling:null,_vpRegionCache:null,_dimCache:null,_scrollTimer:null,
_getVPRegion:function(){var a={},a=this.get("parentScroll"),b=this.get("buffer"),c=this.get("windowScroll"),d=c?[]:a.getXY(),e=c?"winWidth":"offsetWidth",m=c?"winHeight":"offsetHeight",p=c?a.get("scrollTop"):d[1],c=c?a.get("scrollLeft"):d[0];return this._vpRegionCache=a={top:p+b,right:a.get(e)+c-b,bottom:a.get(m)+p-b,left:c+b}},initializer:function(){var b=this.get("host");b.after("drag:start",a.bind(this.start,this));b.after("drag:end",a.bind(this.end,this));b.on("drag:align",a.bind(this.align,this));
a.one("win").on("scroll",a.bind(function(){this._vpRegionCache=null},this))},_checkWinScroll:function(a){var b=this._getVPRegion(),c=this.get("host"),d=this.get("windowScroll"),e=c.lastXY,m=!1,p=this.get("buffer"),n=this.get("parentScroll"),r=n.get("scrollTop"),q=n.get("scrollLeft"),y=e[1]+this._dimCache.h,w=e[1],z=e[0]+this._dimCache.w,x=e[0],s=w,t=x,u=r,v=q;this.get("horizontal")&&(x<=b.left&&(m=!0,t=e[0]-(d?p:0),v=q-p),z>=b.right&&(m=!0,t=e[0]+(d?p:0),v=q+p));this.get("vertical")&&(y>=b.bottom&&
(m=!0,s=e[1]+(d?p:0),u=r+p),w<=b.top&&(m=!0,s=e[1]-(d?p:0),u=r-p));0>u&&(u=0,s=e[1]);0>v&&(v=0,t=e[0]);0>s&&(s=e[1]);0>t&&(t=e[0]);a?(c.actXY=[t,s],c._alignNode([t,s],!0),c.actXY=[t,s],c._moveNode({node:n,top:u,left:v}),!u&&!v&&this._cancelScroll()):m?this._initScroll():this._cancelScroll()},_initScroll:function(){this._cancelScroll();this._scrollTimer=a.Lang.later(this.get("scrollDelay"),this,this._checkWinScroll,[!0],!0)},_cancelScroll:function(){this._scrolling=!1;this._scrollTimer&&(this._scrollTimer.cancel(),
delete this._scrollTimer)},align:function(a){this._scrolling&&(this._cancelScroll(),a.preventDefault());this._scrolling||this._checkWinScroll()},_setDimCache:function(){var a=this.get("host").get("dragNode");this._dimCache={h:a.get("offsetHeight"),w:a.get("offsetWidth")}},start:function(){this._setDimCache()},end:function(){this._dimCache=null;this._cancelScroll()}});a.namespace("Plugin");e=function(){e.superclass.constructor.apply(this,arguments)};e.ATTRS=a.merge(b.ATTRS,{windowScroll:{value:!0,
setter:function(b){b&&this.set("parentScroll",a.one("win"));return b}}});a.extend(e,b,{initializer:function(){this.set("windowScroll",this.get("windowScroll"))}});e.NAME=e.NS="winscroll";a.Plugin.DDWinScroll=e;d=function(){d.superclass.constructor.apply(this,arguments)};d.ATTRS=a.merge(b.ATTRS,{node:{value:!1,setter:function(b){var c=a.one(b);c?this.set("parentScroll",c):!1!==b&&a.error("DDNodeScroll: Invalid Node Given: "+b);return c}}});a.extend(d,b,{initializer:function(){this.set("node",this.get("node"))}});
d.NAME=d.NS="nodescroll";a.Plugin.DDNodeScroll=d;a.DD.Scroll=b},"3.17.2",{requires:["dd-drag"]});
YUI.add("dd-delegate",function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments)},e=a.Node.create("<div>Temp Node</div>");a.extend(b,a.Base,{_bubbleTargets:a.DD.DDM,dd:null,_shimState:null,_handles:null,_onNodeChange:function(a){this.set("dragNode",a.newVal)},_afterDragEnd:function(){a.DD.DDM._noShim=this._shimState;this.set("lastNode",this.dd.get("node"));this.get("lastNode").removeClass(a.DD.DDM.CSS_PREFIX+"-dragging");this.dd._unprep();this.dd.set("node",e)},_delMouseDown:function(b){var c=
b.currentTarget,e=this.dd,h=c,k=this.get("dragConfig");c.test(this.get("nodes"))&&!c.test(this.get("invalid"))&&(this._shimState=a.DD.DDM._noShim,a.DD.DDM._noShim=!0,this.set("currentNode",c),e.set("node",c),k&&k.dragNode?h=k.dragNode:e.proxy&&(h=a.DD.DDM._proxy),e.set("dragNode",h),e._prep(),e.fire("drag:mouseDown",{ev:b}))},_onMouseEnter:function(){this._shimState=a.DD.DDM._noShim;a.DD.DDM._noShim=!0},_onMouseLeave:function(){a.DD.DDM._noShim=this._shimState},initializer:function(){this._handles=
[];var b=this.get("dragConfig")||{},c=this.get("container");b.node=e.cloneNode(!0);b.bubbleTargets=this;this.get("handles")&&(b.handles=this.get("handles"));this.dd=new a.DD.Drag(b);this.dd.after("drag:end",a.bind(this._afterDragEnd,this));this.dd.on("dragNodeChange",a.bind(this._onNodeChange,this));this.dd.after("drag:mouseup",function(){this._unprep()});this._handles.push(a.delegate(a.DD.Drag.START_EVENT,a.bind(this._delMouseDown,this),c,this.get("nodes")));this._handles.push(a.on("mouseenter",
a.bind(this._onMouseEnter,this),c));this._handles.push(a.on("mouseleave",a.bind(this._onMouseLeave,this),c));a.later(50,this,this.syncTargets);a.DD.DDM.regDelegate(this)},syncTargets:function(){if(a.Plugin.Drop&&!this.get("destroyed")){var b,c,e;if(this.get("target")){b=a.one(this.get("container")).all(this.get("nodes"));c=this.dd.get("groups");if((e=this.get("dragConfig"))&&e.groups)c=e.groups;b.each(function(a){this.createDrop(a,c)},this)}return this}},createDrop:function(b,c){var e={useShim:!1,
bubbleTargets:this};b.drop||b.plug(a.Plugin.Drop,e);b.drop.set("groups",c);return b},destructor:function(){this.dd&&this.dd.destroy();a.Plugin.Drop&&a.one(this.get("container")).all(this.get("nodes")).unplug(a.Plugin.Drop);a.Array.each(this._handles,function(a){a.detach()})}},{NAME:"delegate",ATTRS:{container:{value:"body"},nodes:{value:".dd-draggable"},invalid:{value:"input, select, button, a, textarea"},lastNode:{value:e},currentNode:{value:e},dragNode:{value:e},over:{value:!1},target:{value:!1},
dragConfig:{value:null},handles:{value:null}}});a.mix(a.DD.DDM,{_delegates:[],regDelegate:function(a){this._delegates.push(a)},getDelegate:function(b){var c=null;b=a.one(b);a.Array.each(this._delegates,function(a){b.test(a.get("container"))&&(c=a)},this);return c}});a.namespace("DD");a.DD.Delegate=b},"3.17.2",{requires:["dd-drag","dd-drop-plugin","event-mouseenter"]});
YUI.add("dd-drop-plugin",function(a,c){var b=function(a){a.node=a.host;b.superclass.constructor.apply(this,arguments)};b.NAME="dd-drop-plugin";b.NS="drop";a.extend(b,a.DD.Drop);a.namespace("Plugin");a.Plugin.Drop=b},"3.17.2",{requires:["dd-drop"]});
YUI.add("node-focusmanager",function(a,c){var b={37:!0,38:!0,39:!0,40:!0},e={a:!0,button:!0,input:!0,object:!0},d=a.Lang,f=a.UA,g=function(){g.superclass.constructor.apply(this,arguments)};g.ATTRS={focused:{value:!1,readOnly:!0},descendants:{getter:function(a){return this.get("host").all(a)}},activeDescendant:{setter:function(b){var c=d.isNumber,f=a.Attribute.INVALID_VALUE,e=this._descendantsMap,g=this._descendants,n;c(b)?b=n=b:b instanceof a.Node&&e?(n=e[b.get("id")],b=c(n)?n:f):b=f;g&&(g=g.item(n))&&
g.get("disabled")&&(b=f);return b}},keys:{value:{next:null,previous:null}},focusClass:{},circular:{value:!0}};a.extend(g,a.Plugin.Base,{_stopped:!0,_descendants:null,_descendantsMap:null,_focusedNode:null,_lastNodeIndex:0,_eventHandlers:null,_initDescendants:function(){var b=this.get("descendants"),c={},f=-1,e,g=this.get("activeDescendant"),n,r,q=0;d.isUndefined(g)&&(g=-1);if(b){e=b.size();for(q=0;q<e;q++)n=b.item(q),-1===f&&!n.get("disabled")&&(f=q),0>g&&0===parseInt(n.getAttribute("tabIndex",2),
10)&&(g=q),n&&n.set("tabIndex",-1),r=n.get("id"),r||(r=a.guid(),n.set("id",r)),c[r]=q;0>g&&(g=0);n=b.item(g);if(!n||n.get("disabled"))n=b.item(f),g=f;this._lastNodeIndex=e-1;this._descendants=b;this._descendantsMap=c;this.set("activeDescendant",g);n&&n.set("tabIndex",0)}},_isDescendant:function(a){return a.get("id")in this._descendantsMap},_removeFocusClass:function(){var a=this._focusedNode,b=this.get("focusClass"),c;b&&(c=d.isString(b)?b:b.className);a&&c&&a.removeClass(c)},_detachKeyHandler:function(){var a=
this._prevKeyHandler,b=this._nextKeyHandler;a&&a.detach();b&&b.detach()},_preventScroll:function(a){b[a.keyCode]&&this._isDescendant(a.target)&&a.preventDefault()},_fireClick:function(a){var b=a.target,c=b.get("nodeName").toLowerCase();13===a.keyCode&&(!e[c]||"a"===c&&!b.getAttribute("href"))&&b.simulate("click")},_attachKeyHandler:function(){this._detachKeyHandler();var b=this.get("keys.next"),c=this.get("keys.previous"),d=this.get("host"),e=this._eventHandlers;c&&(this._prevKeyHandler=a.on("key",
a.bind(this._focusPrevious,this),d,c));b&&(this._nextKeyHandler=a.on("key",a.bind(this._focusNext,this),d,b));f.opera&&e.push(d.on("keypress",this._preventScroll,this));f.opera||e.push(d.on("keypress",this._fireClick,this))},_detachEventHandlers:function(){this._detachKeyHandler();var b=this._eventHandlers;b&&(a.Array.each(b,function(a){a.detach()}),this._eventHandlers=null)},_attachEventHandlers:function(){var b=this._descendants,c,d;b&&b.size()&&(b=this._eventHandlers||[],c=this.get("host").get("ownerDocument"),
0===b.length&&(b.push(c.on("focus",this._onDocFocus,this)),b.push(c.on("mousedown",this._onDocMouseDown,this)),b.push(this.after("keysChange",this._attachKeyHandler)),b.push(this.after("descendantsChange",this._initDescendants)),b.push(this.after("activeDescendantChange",this._afterActiveDescendantChange)),d=this.after("focusedChange",a.bind(function(a){a.newVal&&(this._attachKeyHandler(),d.detach())},this)),b.push(d)),this._eventHandlers=b)},_onDocMouseDown:function(a){var b=this.get("host"),c=a.target,
d=b.contains(c),e,g=function(a){var c=!1;a.compareTo(b)||(c=this._isDescendant(a)?a:g.call(this,a.get("parentNode")));return c};d&&((e=g.call(this,c))?c=e:!e&&this.get("focused")&&(this._set("focused",!1),this._onDocFocus(a)));if(d&&this._isDescendant(c))this.focus(c);else if(f.webkit&&this.get("focused")&&(!d||d&&!this._isDescendant(c)))this._set("focused",!1),this._onDocFocus(a)},_onDocFocus:function(a){a=this._focusTarget||a.target;var b=this.get("focused"),c=this.get("focusClass"),d=this._focusedNode,
f;this._focusTarget&&(this._focusTarget=null);this.get("host").contains(a)?(f=this._isDescendant(a),!b&&f?b=!0:b&&!f&&(b=!1)):b=!1;c&&(d&&(!d.compareTo(a)||!b)&&this._removeFocusClass(),f&&b&&(c.fn?(a=c.fn(a),a.addClass(c.className)):a.addClass(c),this._focusedNode=a));this._set("focused",b)},_focusNext:function(a,b){var c=b||this.get("activeDescendant"),d;this._isDescendant(a.target)&&c<=this._lastNodeIndex&&(c+=1,c===this._lastNodeIndex+1&&this.get("circular")&&(c=0),(d=this._descendants.item(c))&&
(d.get("disabled")?this._focusNext(a,c):this.focus(c)));this._preventScroll(a)},_focusPrevious:function(a,b){var c=b||this.get("activeDescendant"),d;this._isDescendant(a.target)&&0<=c&&(c-=1,-1===c&&this.get("circular")&&(c=this._lastNodeIndex),(d=this._descendants.item(c))&&(d.get("disabled")?this._focusPrevious(a,c):this.focus(c)));this._preventScroll(a)},_afterActiveDescendantChange:function(a){var b=this._descendants.item(a.prevVal);b&&b.set("tabIndex",-1);(b=this._descendants.item(a.newVal))&&
b.set("tabIndex",0)},initializer:function(a){this.start()},destructor:function(){this.stop();this.get("host").focusManager=null},focus:function(a){d.isUndefined(a)&&(a=this.get("activeDescendant"));this.set("activeDescendant",a,{src:"UI"});if(a=this._descendants.item(this.get("activeDescendant")))a.focus(),f.opera&&"button"===a.get("nodeName").toLowerCase()&&(this._focusTarget=a)},blur:function(){var a;if(this.get("focused")){if(a=this._descendants.item(this.get("activeDescendant")))a.blur(),this._removeFocusClass();
this._set("focused",!1,{src:"UI"})}},start:function(){this._stopped&&(this._initDescendants(),this._attachEventHandlers(),this._stopped=!1)},stop:function(){this._stopped||(this._detachEventHandlers(),this._focusedNode=this._descendants=null,this._lastNodeIndex=0,this._stopped=!0)},refresh:function(){this._initDescendants();this._eventHandlers||this._attachEventHandlers()}});g.NAME="nodeFocusManager";g.NS="focusManager";a.namespace("Plugin");a.Plugin.NodeFocusManager=g},"3.17.2",{requires:"attribute node plugin node-event-simulate event-key event-focus".split(" ")});
YUI.add("squarespace-animation-manager",function(a){a.namespace("Squarespace").AnimationManager=Class.create({initialize:function(){this._concurrentAnimations=[];this._destroyed=this._animationsFinished=!1},push:function(c){if(a.Lang.isArray(c))for(var b=0;b<c.length;b++)this._concurrentAnimations.push(c[b]);else this._concurrentAnimations.push(c)},run:function(a,b){this.callback=a;this.context=b||this;for(var e=function(){this._animEnd()},d=0;d<this._concurrentAnimations.length;d++)this._concurrentAnimations[d]&&
(this._concurrentAnimations[d].once("end",e,this),this._concurrentAnimations[d].run());this._running=!0},stop:function(a){a=!!a;for(var b=0;b<this._concurrentAnimations.length;b++)this._concurrentAnimations[b]&&(this._concurrentAnimations[b].stop(a),this._animationsFinished=!0);this._running&&(this._running=!1)},_animEnd:function(){a.Array.every(this._concurrentAnimations,function(a){return!a.get("running")})&&(this._animationsFinished=!0,this._running=!1,this.callback&&this.callback.call(this.context),
this.fire("end"))},isRunning:function(){return this._running},destroy:function(a){this.fire("destroy");if(this._destroyed)throw Error("MultipleAnimationManager: Sorry bro, I'm already destroyed.");this._destroyed=!0;this.stop(a);for(var b=0;b<this._concurrentAnimations.length;b++)this._concurrentAnimations[b]&&this._concurrentAnimations[b].destroy(!0);this._running&&(this._running=!1,this._animationsFinished=!!a);this.fire("destroyed")},isDestroyed:function(){return this._destroyed}});a.augment(a.Squarespace.AnimationManager,
a.EventTarget)},"1.0");
YUI.add("squarespace-dialog-field-2",function(a){a.namespace("Squarespace.Widgets").DialogField2=a.namespace("Squarespace").DialogField2=a.Base.create("dialogField",a.Squarespace.Widgets.DataWidget,[a.Squarespace.DialogFieldLegacyInterface,a.WidgetParent,a.WidgetChild],{initializer:function(a){this._saveInitialData(a?a.data:null);this.publish("error-shown",{broadcast:2})},destructor:function(){this._destroyError();this.unplug(a.Plugin.WidgetAnim);this._initialData=void 0;this._errorFlyoutSub&&this._errorFlyoutSub.detach()},
_destroyError:function(){this._errorNode&&(this._errorNode.remove(!0),this._errorNode=null)},_saveInitialData:function(c){c=!a.Lang.isValue(c)?this.get("data"):c;a.Lang.isArray(c)&&this.get("cloneInitialData")?this._initialData=c.slice():a.Lang.isObject(c)&&this.get("cloneInitialData")?this._initialData=a.clone(c,!0):this._initialData=c},setCurrentDataAsInitial:function(){this._saveInitialData()},renderUI:function(){a.Squarespace.DialogField2.superclass.renderUI.call(this);var c=this.get("name");
c&&this.get("boundingBox").addClass("name-"+c)},scrollIntoView:function(){this.get("contentBox").scrollIntoView()},showError:function(c){if(c&&this.get("rendered")){var b=this.get("boundingBox"),e=this.get("contentBox"),d=this.get("errorFlyoutAnchor")||e,e=this.get("errorFlyoutAnimationTime");d.hasPlugin("flyoutPlugin")||d.plug(a.Squarespace.Animations.Flyout,{duration:e,renderTarget:this.get("errorFlyoutRenderTarget")});var f=d.flyoutPlugin,g=a.bind(function(){b.addClass("error");this._destroyError();
this._errorNode=a.Node.create('<div class="sqs-flyout-error-message">'+c+"</div>");var e=this.get("dialog");e&&this._errorNode.setStyle("zIndex",e.zIndex+10);this._errorNode.on(this.get("id")+"|click",function(a){a.halt();this.hideError()},this);var g=a.one(window).get("region"),l=a.Squarespace.NodeUtils.measureNode(this._errorNode).width,e=d.get("region");e.right+l<=g.right?(g="rt",this._errorNode.addClass("out-from-right")):e.left-l>g.left?(g="lt",this._errorNode.addClass("out-from-left")):(g="bl",
this._errorNode.addClass("out-from-bottom"),this._errorNode.setStyle("width",e.width));f.setAttrs({node:this._errorNode,alignment:g});this._clearErrorSub=a.on(this.get("id")+"|click",this.hideError,this);e=this.get("id");f.once(e+"|shown",function(a){this.fire("error-shown",{message:c})},this);this._errorFlyoutSub=d.once("flyout-shown",function(a){this._errorNode.setStyle("width","100%")},this);f.show()},this);f.get("visible")?(this._isHiding=!0,this._showErrorSub&&this._showErrorSub.detach(),this._showErrorSub=
f.once(this.get("id")+"|hidden",function(){this._showErrorSub=null;this._isHiding=!1;g()},this),f.hide()):g()}},hideError:function(){if(this.get("rendered")&&!this._isHiding){var a=this.get("boundingBox"),b=this.get("contentBox"),b=this.get("errorFlyoutAnchor")||b;b.hasPlugin("flyoutPlugin")&&b.flyoutPlugin.get("visible")&&(this._clearErrorSub&&(this._clearErrorSub.detach(),this._clearErrorSub=null),b=b.flyoutPlugin,b.once(this.get("id")+"|hidden",function(b){a.removeClass("error");this.fire("error-hidden");
this._destroyError()},this),b.hide())}},didDataChange:function(){var c=this.get("data");if(this.get("readOnly"))return!1;if(a.Lang.isArray(this._initialData))return a.JSON.stringify(this._initialData)!==a.JSON.stringify(c);if(a.Lang.isObject(this._initialData))throw Error("DialogField base class will not compare objects. Define didDataChange for this field.");return this._initialData!==c},isEmpty:function(){var a=this.get("data");return""===a||0===a},revert:function(){this.set("data",this._initialData,
{revert:!0})},_getErrors:function(){return[]},isValid:function(){return!a.Lang.isArray(this.get("errors"))||0===this.get("errors").length}},{CSS_PREFIX:"sqs-dialog-field",ATTRS:{cloneInitialData:{value:!0},strings:{},name:{value:null,validator:a.Squarespace.AttrValidators.isNullOrString},dialog:{value:null,validator:function(c){if(a.Lang.isNull(c)||c instanceof a.Squarespace.EditingDialog||c.constructor instanceof a.Squarespace.EditingDialog.constructor)return!0;console.warn(this.name+": Not an EditingDialog");
return!1}},readOnly:{value:!1,validator:a.Squarespace.AttrValidators.isBoolean},required:{value:!1,validator:a.Squarespace.AttrValidators.isBoolean},errors:{value:[],readOnly:!0,getter:"_getErrors",validator:a.Squarespace.AttrValidators.isArray},errorFlyoutAnchor:{value:null,readOnly:!0,validator:a.Squarespace.AttrValidators.isNullOrInstanceOf(a.Node)},errorFlyoutRenderTarget:{value:void 0},errorFlyoutAnimationTime:{value:0.3},focusable:{value:!0,validator:a.Lang.isBoolean}}})},"1.0",{requires:"base json-stringify squarespace-animations squarespace-attr-validators squarespace-dialog-field-legacy-interface squarespace-flyout-error-message-template squarespace-node-flyout squarespace-node-utils squarespace-widgets-data-widget widget-anim widget-child widget-parent".split(" ")});
YUI.add("squarespace-dialog-field-legacy-interface",function(a){var c=a.namespace("Squarespace").DialogFieldLegacyInterface=function(b){this.inActiveFrame=!0;a.Lang.isFunction(this.hideError)&&a.Do.after(function(){var a=b.dialog;a&&a.clearError(this)},this,"hideError",this);a.Do.after(function(){this.after(this.get("id")+"|dataChange",function(a){var c=b.dialog;c&&!a.silent&&c.fire("datachange",this);(c=this.get("name"))&&this.fire("value-changed",{name:c,value:a.newVal,oldValue:a.prevVal,field:this})},
this)},this,"bindUI",this);a.Do.after(function(){b&&b.defaultHidden&&this.hide(!0)},this,"syncUI",this)};c.NAME="dialogFieldLegacyInterface";c.prototype={temporaryHide:function(){this.hide()},temporaryShow:function(){this.show()},getName:function(){return this.get("name")},getType:function(){return this.name},getValue:function(){return this.get("data")},getErrors:function(){return this.get("errors")},getNode:function(){return this.get("boundingBox")},setValue:function(a){this.set("data",a)},clearError:function(){this.hideError()}}},
"1.0");
YUI.add("squarespace-flyout-error-message-template",function(a){var c=a.Handlebars;(function(){var a=c.template;(c.templates=c.templates||{})["flyout-error-message.html"]=a(function(a,b,c,g,h){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);h=h||{};a='<div class="sqs-flyout-error-message">';(c=c.message)?c=c.call(b,{hash:{},data:h}):(c=b.message,c="function"===typeof c?c.apply(b):c);if(c||0===c)a+=c;return a+"</div>"})})();a.Handlebars.registerPartial("flyout-error-message.html".replace("/","."),
c.templates["flyout-error-message.html"])},"1.0",{requires:["handlebars-base"]});
YUI.add("squarespace-widgets-data-widget",function(a){a.namespace("Squarespace.Widgets");var c=a.Squarespace.Widgets.DataWidget=a.Base.create("dataWidget",a.Squarespace.Widgets.SSWidget,[],{initializer:function(a){a.dataState||(this.getProperty("ASYNC_DATA")?this.set("dataState",this.getProperty("DATA_STATES").INITIALIZED):this.set("dataState",this.getProperty("DATA_STATES").LOADED))},renderUI:function(){c.superclass.renderUI.call(this);this._updateDataStateClassName()},bindUI:function(){c.superclass.bindUI.call(this);
var a=this.get("id");this.after(a+"|dataChange",function(a){a.noSyncUI||this.syncUI()},this);this.after(a+"|dataStateChange",this._updateDataStateClassName,this)},_updateDataStateClassName:function(){var b=this.get("boundingBox"),c=this.get("dataState");a.Object.each(this.getProperty("DATA_STATES"),function(a){b.removeClass("data-state-"+a)});b.addClass("data-state-"+c)},setLoadingState:function(){return this.set("dataState",this.getProperty("DATA_STATES").LOADING)},setLoadedState:function(){return this.set("dataState",
this.getProperty("DATA_STATES").LOADED)},setLoadFailedState:function(){return this.set("dataState",this.getProperty("DATA_STATES").LOAD_FAILED)},loadedSuccessfully:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOADED},isLoading:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOADING},loadFailed:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOAD_FAILED}},{CSS_PREFIX:"sqs-data-widget",ASYNC_DATA:!1,DATA_STATES:{INITIALIZED:"initialized",
LOADING:"loading",LOADED:"loaded",LOAD_FAILED:"load-failed"},ATTRS:{data:{value:null,validator:function(b){return a.Lang.isUndefined(b)?(console.warn(this.name+": Will not set data to undefined."),!1):!0}},dataState:{valueFn:function(){return this.getProperty("DATA_STATES").INITIALIZED}},preventRenderTemplate:{value:!1,validator:a.Squarespace.AttrValidators.isBoolean}}})},"1.0",{requires:["base","node","widget","squarespace-ss-widget","squarespace-attr-validators"]});
YUI.add("widget-anim",function(a,c){function b(a){b.superclass.constructor.apply(this,arguments)}b.NS="anim";b.NAME="pluginWidgetAnim";b.ANIMATIONS={fadeIn:function(){var b=this.get("host"),c=b.get("boundingBox"),f=new a.Anim({node:c,to:{opacity:1},duration:this.get("duration")});b.get("visible")||c.setStyle("opacity",0);f.on("destroy",function(){this.get("node").setStyle("opacity",a.UA.ie?1:"")});return f},fadeOut:function(){return new a.Anim({node:this.get("host").get("boundingBox"),to:{opacity:0},
duration:this.get("duration")})}};b.ATTRS={duration:{value:0.2},animShow:{valueFn:b.ANIMATIONS.fadeIn},animHide:{valueFn:b.ANIMATIONS.fadeOut}};a.extend(b,a.Plugin.Base,{initializer:function(a){this._bindAnimShow();this._bindAnimHide();this.after("animShowChange",this._bindAnimShow);this.after("animHideChange",this._bindAnimHide);this.beforeHostMethod("_uiSetVisible",this._uiAnimSetVisible)},destructor:function(){this.get("animShow").destroy();this.get("animHide").destroy()},_uiAnimSetVisible:function(b){if(this.get("host").get("rendered"))return b?
(this.get("animHide").stop(),this.get("animShow").run()):(this.get("animShow").stop(),this.get("animHide").run()),new a.Do.Prevent},_uiSetVisible:function(a){var b=this.get("host"),c=b.getClassName("hidden");b.get("boundingBox").toggleClass(c,!a)},_bindAnimShow:function(){this.get("animShow").on("start",a.bind(function(){this._uiSetVisible(!0)},this))},_bindAnimHide:function(){this.get("animHide").after("end",a.bind(function(){this._uiSetVisible(!1)},this))}});a.namespace("Plugin").WidgetAnim=b},
"3.17.2",{requires:["anim-base","plugin","widget"]});
YUI.add("widget-child",function(a,c){function b(){a.after(this._syncUIChild,this,"syncUI");a.after(this._bindUIChild,this,"bindUI")}var e=a.Lang;b.ATTRS={selected:{value:0,validator:e.isNumber},index:{readOnly:!0,getter:function(){var a=this.get("parent"),b=-1;a&&(b=a.indexOf(this));return b}},parent:{readOnly:!0},depth:{readOnly:!0,getter:function(){for(var a=this.get("parent"),b=this.get("root"),c=-1;a;){c+=1;if(a==b)break;a=a.get("parent")}return c}},root:{readOnly:!0,getter:function(){var b=function(c){var e=
c.get("parent"),h=c.ROOT_TYPE,k=e;h&&(k=e&&a.instanceOf(e,h));return k?b(e):c};return b(this)}}};b.prototype={ROOT_TYPE:null,_getUIEventNode:function(){var a=this.get("root"),b;a&&(b=a.get("boundingBox"));return b},next:function(a){var b=this.get("parent"),c;b&&(c=b.item(this.get("index")+1));!c&&a&&(c=b.item(0));return c},previous:function(a){var b=this.get("parent"),c=this.get("index"),e;b&&0<c&&(e=b.item([c-1]));!e&&a&&(e=b.item(b.size()-1));return e},remove:function(b){var c,g;e.isNumber(b)?g=
a.WidgetParent.prototype.remove.apply(this,arguments):(c=this.get("parent"))&&(g=c.remove(this.get("index")));return g},isRoot:function(){return this==this.get("root")},ancestor:function(a){var b=this.get("root"),c;if(this.get("depth")>a)for(c=this.get("parent");c!=b&&c.get("depth")>a;)c=c.get("parent");return c},_uiSetChildSelected:function(a){var b=this.get("boundingBox"),c=this.getClassName("selected");0===a?b.removeClass(c):b.addClass(c)},_afterChildSelectedChange:function(a){this._uiSetChildSelected(a.newVal)},
_syncUIChild:function(){this._uiSetChildSelected(this.get("selected"))},_bindUIChild:function(){this.after("selectedChange",this._afterChildSelectedChange)}};a.WidgetChild=b},"3.17.2",{requires:["base-build","widget"]});
YUI.add("widget-parent",function(a,c){function b(b){this.publish("addChild",{defaultTargetOnly:!0,defaultFn:this._defAddChildFn});this.publish("removeChild",{defaultTargetOnly:!0,defaultFn:this._defRemoveChildFn});this._items=[];var c,e;b&&b.children&&(c=b.children,e=this.after("initializedChange",function(a){this._add(c);e.detach()}));a.after(this._renderChildren,this,"renderUI");a.after(this._bindUIParent,this,"bindUI");this.after("selectionChange",this._afterSelectionChange);this.after("selectedChange",
this._afterParentSelectedChange);this.after("activeDescendantChange",this._afterActiveDescendantChange);this._hDestroyChild=this.after("*:destroy",this._afterDestroyChild);this.after("*:focusedChange",this._updateActiveDescendant)}var e=a.Lang;b.ATTRS={defaultChildType:{setter:function(b){var c=a.Attribute.INVALID_VALUE;b=e.isString(b)?a[b]:b;e.isFunction(b)&&(c=b);return c}},activeDescendant:{readOnly:!0},multiple:{value:!1,validator:e.isBoolean,writeOnce:!0,getter:function(a){var b=this.get("root");
return b&&b!=this?b.get("multiple"):a}},selection:{readOnly:!0,setter:"_setSelection",getter:function(b){return e.isArray(b)?new a.ArrayList(b):b}},selected:{setter:function(b){var c=b;1===b&&!this.get("multiple")&&(c=a.Attribute.INVALID_VALUE);return c}}};b.prototype={destructor:function(){this._destroyChildren()},_afterDestroyChild:function(a){a=a.target;a.get("parent")==this&&a.remove()},_afterSelectionChange:function(b){if(b.target==this&&b.src!=this){b=b.newVal;var c=0;b&&(c=2,a.instanceOf(b,
a.ArrayList)&&b.size()===this.size()&&(c=1));this.set("selected",c,{src:this})}},_afterActiveDescendantChange:function(a){var b=this.get("parent");b&&b._set("activeDescendant",a.newVal)},_afterParentSelectedChange:function(a){var b=a.newVal;this==a.target&&(a.src!=this&&(0===b||1===b))&&this.each(function(a){a.set("selected",b,{src:this})},this)},_setSelection:function(a){var b=null,c;this.get("multiple")&&!this.isEmpty()?(c=[],this.each(function(a){0<a.get("selected")&&c.push(a)}),0<c.length&&(b=
c)):0<a.get("selected")&&(b=a);return b},_updateSelection:function(a){var b=a.target,c;b.get("parent")==this&&("_updateSelection"!=a.src&&(c=this.get("selection"),!this.get("multiple")&&(c&&0<a.newVal)&&c.set("selected",0,{src:"_updateSelection"}),this._set("selection",b)),a.src==this&&this._set("selection",b,{src:this}))},_updateActiveDescendant:function(a){this._set("activeDescendant",!0===a.newVal?a.target:null)},_createChild:function(b){var c=this.get("defaultChildType"),g=b.childType||b.type,
h,k,l;g&&(k=e.isString(g)?a[g]:g);e.isFunction(k)?l=k:c&&(l=c);l?h=new l(b):a.error("Could not create a child instance because its constructor is either undefined or invalid.");return h},_defAddChildFn:function(b){var c=b.child,g=b.index,h=this._items;c.get("parent")&&c.remove();e.isNumber(g)?h.splice(g,0,c):h.push(c);c._set("parent",this);c.addTarget(this);b.index=c.get("index");c.after("selectedChange",a.bind(this._updateSelection,this))},_defRemoveChildFn:function(a){var b=a.child;a=a.index;var c=
this._items;b.get("focused")&&b.blur();b.get("selected")&&b.set("selected",0);c.splice(a,1);b.removeTarget(this);b._oldParent=b.get("parent");b._set("parent",null)},_add:function(b,c){var g,h,k;e.isArray(b)?(g=[],a.each(b,function(a,b){(h=this._add(a,c+b))&&g.push(h)},this),0<g.length&&(k=g)):(h=a.instanceOf(b,a.Widget)?b:this._createChild(b))&&this.fire("addChild",{child:h,index:c})&&(k=h);return k},add:function(){var b=this._add.apply(this,arguments),b=b?e.isArray(b)?b:[b]:[];return new a.ArrayList(b)},
remove:function(a){var b=this._items[a],c;b&&this.fire("removeChild",{child:b,index:a})&&(c=b);return c},removeAll:function(){var b=[],c;a.each(this._items.concat(),function(){(c=this.remove(0))&&b.push(c)},this);return new a.ArrayList(b)},selectChild:function(a){this.item(a).set("selected",1)},selectAll:function(){this.set("selected",1)},deselectAll:function(){this.set("selected",0)},_uiAddChild:function(a,b){a.render(b);var c=a.get("boundingBox"),e;(e=a.next(!1))&&e.get("rendered")?(e=e.get("boundingBox"),
e.insert(c,"before")):(e=a.previous(!1))&&e.get("rendered")?(e=e.get("boundingBox"),e.insert(c,"after")):b.contains(c)||b.appendChild(c)},_uiRemoveChild:function(a){a.get("boundingBox").remove()},_afterAddChild:function(a){a=a.child;a.get("parent")==this&&this._uiAddChild(a,this._childrenContainer)},_afterRemoveChild:function(a){a=a.child;a._oldParent==this&&this._uiRemoveChild(a)},_bindUIParent:function(){this.after("addChild",this._afterAddChild);this.after("removeChild",this._afterRemoveChild)},
_renderChildren:function(){var a=this._childrenContainer||this.get("contentBox");this._childrenContainer=a;this.each(function(b){b.render(a)})},_destroyChildren:function(){this._hDestroyChild.detach();this.each(function(a){a.destroy()})}};a.augment(b,a.ArrayList);a.WidgetParent=b},"3.17.2",{requires:["arraylist","base-build","widget"]});
YUI.add("squarespace-dialog-fields",function(a){a.namespace("Squarespace");a.Squarespace.DialogField=Class.extend(a.Squarespace.Gizmo,{_name:"DialogField",initialize:function(c,b,e){this._super();this.config=a.merge({defaultHidden:!1},c);this.dialog=this.panel=e;this.initialData=a.merge({},b);this.className="";this.inActiveFrame=!0;this.config&&("undefined"!==typeof this.config.name&&this.config.name in b)&&(this.value=b[this.config.name])},hide:function(a){this.temporaryHide(a)},getTakenHeight:function(){return this.html.get("offsetHeight")},
show:function(a){this.temporaryShow(a)},getName:function(){return this.config.name},getType:function(){return this.type},getDialog:function(){return this.dialog},append:function(a){a.append(this.html);this.config.defaultHidden&&this.temporaryHide(!1)},resize:function(){},isValid:function(){return 0<this.getErrors().length},getErrors:function(){return this.config.validator&&this.config.validationErrorMsg&&!this.config.validator.call(this,this.dialog)?[this.config.validationErrorMsg]:[]},showError:function(c){if(c){var b=
this.errorFlyoutAnchor||this.control;b||console.error("dialog-field: [DialogField] No control or error flyout anchor set to throw form field error on. Set this.control or this.errorFlyoutAnchor to a node.");b.hasPlugin("flyoutPlugin")||b.plug(a.Squarespace.Animations.Flyout,{duration:0.3});b=b.flyoutPlugin;b.get("visible")?(this._showErrorSub&&this._showErrorSub.detach(),this._showErrorSub=b.once(this.getId()+"|hidden",function(){this._showErrorSub=null;this._doShowErrorFlyout(c)},this),b.hide()):
this._doShowErrorFlyout(c)}},_doShowErrorFlyout:function(c){var b=this.errorFlyoutAnchor||this.control,e=b.flyoutPlugin;this.html.addClass("error");this._errorEl||(this._errorEl=a.Node.create('<div class="flyout-error-message">'+c+"</div>"),this._errorEl.setStyle("zIndex",this.dialog.zIndex+10),this._errorEl.on(this.getId()+"|click",function(a){a.halt()},this));this._errorEl.setContent(c);c=a.Squarespace.NodeUtils.measureNode(this._errorEl).width;b=b.getX()+b.get("offsetWidth")-(this.html.hasClass("thin")?
-10:1)+c;c=a.one(window).get("region").right;(b=b>c)&&this._errorEl.addClass("out-from-left");e.setAttrs({node:this._errorEl,alignment:b?"lt":"rt"});this._clearErrorSub=a.on(this.getId()+"|click",this.clearError,this.errorEl,this);e.show()},hideError:function(){var a=this.errorFlyoutAnchor||this.control;a&&(a.hasPlugin("flyoutPlugin")&&a.flyoutPlugin.get("visible"))&&(this._clearErrorSub&&this._clearErrorSub.detach(),a=a.flyoutPlugin,this._subscribeOnce(a,this.getId()+"|hidden",function(a){this.html.removeClass("error")},
this),a.hide())},clearError:function(){this.dialog.clearError(this);this.hideError()},scrollIntoView:function(){this.html.scrollIntoView()},updateInlineTitle:function(){},setHeight:function(a){this.control&&this.control.setStyle("height",a+"px")},getValue:function(){return this.value},setValue:function(a){var b=this.value;this.value=a;"config"in this&&"name"in this.config&&this.fire("value-changed",{name:this.config.name,value:a,oldValue:b,field:this})},temporaryHide:function(c){this.fire("hide",
this);this.hidden=!0;this.hideAnim&&this.hideAnim.stop();c?(this.html.setStyle("display","none"),this.fire("hidden",this)):(this.hideAnim=this._anim({node:this.html,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong}),this.hideAnim.on("end",function(){this.html.setStyle("display","none");this.fire("hidden",this)},this),this.hideAnim.run())},temporaryShow:function(){this.fire("show",this);this.hidden=!1;this.hideAnim&&this.hideAnim.stop();this.html.setStyle("display","block");this.hideAnim=
this._anim({node:this.html,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});this.hideAnim.on("end",function(){a.fire("shown",this);a.fire("showing",this);this.fire("shown")},this);this.hideAnim.run()},getNode:function(){return this.html},didDataChange:function(){return this.config.ignoreChanges?!1:!this.initialData||a.Lang.isUndefined(this.initialData[this.getName()])&&""===this.getValue()?!1:a.Lang.isArray(this.initialData[this.getName()])?a.JSON.stringify(this.initialData[this.getName()])!==
a.JSON.stringify(this.getValue()):this.getValue()!==this.initialData[this.getName()]}})},"1.0",{requires:"anim json squarespace-gizmo squarespace-node-flyout squarespace-node-utils squarespace-util widget".split(" ")});
YUI.add("squarespace-gizmo",function(a){a.namespace("Squarespace");var c=/[ ]+/g,b=/[^a-zA-Z0-9\-]/g,e=function(b,c,d,e,l){return(l?a.Array.reject:a.Array.filter)(b,function(a){for(var b=0;b<d.length;++b)if(a[d[b]]!==e[b])return!1;c&&c(a);return!0})},d=function(b,c,e,k,l){if(!this._destroyed){if(a.Lang.isArray(c))return a.Array.map(c,function(c){return d.apply(this,[b].concat(a.Array(c)))},this);if(a.Lang.isObject(c)&&a.Lang.isFunction(c[b])){var m=[e,k,l||this],m=m.concat(Array.prototype.slice.call(arguments,
5)),m=c[b].apply(c,m);this._eventSubList.push({object:c,event:e,eventSub:m});return m}throw"Gizmo["+this._name+"]: Could not subscribe to event: "+e;}};a.Squarespace.Gizmo=Class.create({_name:"Gizmo",_events:{render:{},rendered:{},destroy:{},destroyed:{}},initialize:function(b){a.augment(this,a.EventTarget,!0,null,{prefix:this._name});this.params=a.merge(b);this._initState();b=this;for(var c=function(a,b){this.publish(b,a)};null!==b&&void 0!==b;)a.Object.each(b._events,c,this),b=b.superclass},getClassNames:function(){for(var a=
this,b=[];;a=a.superclass){if(!a)return b;b.push(a.getClassName())}},_initState:function(){this._parentEl=this._el=null;this._eventSubList=[];this._anims=[];this._timers=[];this.destroyed=this._destroyed=!1;this._children=[];this._guid=a.guid();this._name||(this._name="No Name")},getClassName:function(){return this._name},getId:function(){return this._guid},getCssClassName:function(){var a=this._name,a=a.trim().replace(c,"-").replace(b,"").toLowerCase();return"squarespace-"+a},getElement:function(){return this._el},
render:function(b){this.fire("render");b=b||this._parentEl;this.params.noBoundingBox?this._el=this._render():(this._el=a.Node.create("<div></div>"),this._el.addClass(this.getCssClassName()+"-bbox"),this._el.append(this._render()));b&&a.Lang.isFunction(b.append)&&b.append(this._el);this._parentEl=b;this.fire("rendered")},_render:function(){},_subscribe:function(b,c,e,k){var l=["on"].concat(a.Array(arguments));return d.apply(this,l)},_subscribeOnce:function(b,c,e,k){var l=["once"].concat(a.Array(arguments));
return d.apply(this,l)},_subscribeBefore:function(b,c,e,k){var l=["before"].concat(a.Array(arguments));return d.apply(this,l)},_subscribeAfter:function(b,c,e,k){var l=["after"].concat(a.Array(arguments));return d.apply(this,l)},_unsubscribe:function(b,c){this._eventSubList=e(this._eventSubList,function(a){a.eventSub.detach()},c?["object","event"]:["object"],a.Array(arguments),!0)},_detach:function(a){this._eventSubList=e(this._eventSubList,function(a){a.eventSub.detach()},["eventSub"],[a],!0)},_clearEvents:function(){for(var a=
this._eventSubList,b=0;b<a.length;++b)a[b].eventSub.detach();this._eventSubList=[]},destroy:function(){if(this._destroyed)console.warn("Gizmo["+this._name+"] already destroyed.");else{if(!this._eventSubList)throw console.error("Gizmo not initialized for...",this),"Gizmo["+this._name+"] was never initialzed.  Missing _super?";this.fire("destroy");this._destroy();var b=0;this._clearEvents();this._eventSubList=[];var c=[];a.Array.each(this._anims,function(a){c.push(a)},this);a.Array.each(c,function(a){a.get("running")&&
a.stop(!1);a.destroy()});this._anims=null;for(b=this._children;0<b.length;){var d=b[0];d._removeParent();d.destroy()}this._children=null;d=this._timers;for(b=0;b<d.length;++b)d[b].cancel();this._timers=null;this._el&&a.Lang.isFunction(this._el.remove)&&(this._el.remove(),this._el=null);this.destroyed=this._destroyed=!0;this.fire("destroyed")}},_destroy:function(){},isDestroyed:function(){return this._destroyed},_setParent:function(a){this._parentGizmo=a},_removeParent:function(){this._parentGizmo&&
(this._parentGizmo._removeChild(this),this._parentGizmo=null)},_addChild:function(a){this._children&&(a._setParent&&a._setParent(this),this._children.push(a))},_removeChild:function(a){this._children.splice(this._children.indexOf(a),1)},_getChildren:function(){return this._children},_anim:function(b){if(!this._destroyed){if(!b.node)throw Error("Gizmo["+this._name+"]: Animation must specify a node!");var c;b.node.ancestor("body",!0)?b.node._node?(c=new a.Anim(b),c.on("end",function(a){this._removeAnim(c)},
this),this._anims.push(c)):(console.warn("Gizmo["+this._name+"]: _anim passed a YUI node with _node = null! Returning an empty animation."),console.trace(),c=new a.Anim):(console.warn("Gizmo["+this._name+"]: _anim passed a YUI node not in the DOM! Returning an empty animation."),c=new a.Anim);return c}},_removeAnim:function(a){a=this._anims.indexOf(a);-1!==a&&this._anims.splice(a,1)},_trace:function(b){for(var c=this.getEvent(b).getSubs(),d=[],e=function(a,b){if(a.context&&a.context.getName)d.push(a.context.getName());
else{var c={};c[a.fn.name]=a.fn.toString();d.push(c)}},l=0;l<c.length;++l)a.Object.each(c[l],e);console.log("[trace] Event",b,"is notifying the following:",d);this.fire(b)},_later:function(b,c,d,e,l){if(!this._destroyed)return b=a.later(b,d||this,c,e,l),this._timers.push(b),b},_cb:function(b){return a.bind(function(){if(!this._destroyed)return b.apply(this,arguments)},this)}});a.augment(a.Squarespace.Gizmo,a.EventTarget);a.Squarespace.ZombieGizmo=Class.extend(a.Squarespace.Gizmo,{_name:"ZombieGizmo",
_events:{resurrect:{},resurrected:{}},initialize:function(a){this._super(a)},destroy:function(){this._super();this.resurrect()},resurrect:function(){this.fire("resurrect");this._initState();this.fire("resurrected")}})},"1.0",{requires:["array-extras","node","event-custom"]});
YUI.add("squarespace-dialog-legacy-multi-frame",function(a){a.namespace("Squarespace.DialogFieldGenerators");a.Squarespace.DialogFieldGenerators["multi-frame"]=Class.extend(a.Squarespace.DialogField,{initialize:function(c,b,e){this._super(c,b,e);this.frames={};this.activeEl=null;this.value=this.config.initialFrame;this.panel.bodyEvents.push(a.on("click",this.onClick,this.html,this))},onClick:function(a){this.panel.fire("datachange",this)},show:function(c){var b=this.frames[c];if(!(b&&b===this.activeEl)){if(this.activeEl){this.activeEl.a&&
this.activeEl.a.stop();var e=this.activeEl.fields;this.activeEl.a=this._anim({node:this.activeEl.el,to:{height:0},duration:0.3,easing:a.Easing.easeOutStrong});e.forEach(this.setInActiveFrame(!1),this);this.activeEl.a.on("end",function(a){a.target.get("node").addClass("hidden")},this);this.activeEl.a.run()}b.a&&b.a.stop();this.activeEl&&b.el.ancestor().insertBefore(b.el,this.activeEl.el.next());b.el.removeClass("hidden");e=b.el.getStyle("height");b.el.setStyles({height:null});b.realHeight=b.el.get("offsetHeight");
b.el.setStyles({height:e});b.a=this._anim({node:b.el,to:{height:b.realHeight},duration:0.3,easing:a.Easing.easeOutStrong});b.a.on("end",function(a,b){for(var c=0;c<b.fields.length;++c){var e=this.panel.fields[b.fields[c].name];e&&e.updateInlineTitle&&e.updateInlineTitle()}this.focusCurrentFrame()},this,b);b.a.run();b.fields.forEach(this.setInActiveFrame(!0),this);this.activeEl=b;this.value=c}},focusCurrentFrame:function(){for(var c,b=0;b<this.activeEl.fields.length;++b)if(c=this.activeEl.fields[b],
c=this.panel.fields[c.name||a.Object.getValue(c,["config","name"])],a.Lang.isValue(c)&&c.getNode){c.getNode().focus();break}},setInActiveFrame:function(a){return function(b){b.name&&(b=this.panel.getField(b.name),b.inActiveFrame=a,b.fire("mutli-frame-focus"))}},append:function(c,b,e,d){for(var f in this.config.frames){b=this.config.frames[f];var g=a.Node.create('<div class="frame-wrapper clear"></div>');e.append(g);this.panel._renderFields(c,b.fields,g,d);this.frames[f]=this.config.frames[f];this.frames[f].el=
g;this.frames[f].realHeight=g.get("offsetHeight");f!=this.config.initialFrame?(g.setStyle("height","0px"),g.addClass("hidden"),this.frames[f].visible=!1,this.config.frames[f].fields.forEach(this.setInActiveFrame(!1),this)):(this.activeEl=this.frames[f],this.frames[f].visible=!0,this.config.frames[f].fields.forEach(this.setInActiveFrame(!0),this))}}})},"1.0.0",{requires:["anim","squarespace-dialog-fields","squarespace-util","widget"]});
